DROP TABLE PERSNAT_CLIENTE 			CASCADE CONSTRAINTS;
DROP TABLE TRABAJADOR 				CASCADE CONSTRAINTS;
DROP TABLE CLIENTE	 				CASCADE CONSTRAINTS;
DROP TABLE MARCA 					CASCADE CONSTRAINTS;
DROP TABLE PERSONA_JURIDICA 		CASCADE CONSTRAINTS;
DROP TABLE PRODUCTO 				CASCADE CONSTRAINTS;
DROP TABLE PERSONA_NATURAL 			CASCADE CONSTRAINTS;
DROP TABLE SERVICIO 				CASCADE CONSTRAINTS;
DROP TABLE PROVEEDOR 				CASCADE CONSTRAINTS;
DROP TABLE TELEFONO_PERSONA_J 		CASCADE CONSTRAINTS;
DROP TABLE TELEFONO_PERSONA_N 		CASCADE CONSTRAINTS;
DROP TABLE CONTIENE_PRODUCTO 		CASCADE CONSTRAINTS;
DROP TABLE PEDIDO 					CASCADE CONSTRAINTS;
DROP TABLE PERSJUR_CLIENTE 			CASCADE CONSTRAINTS;
DROP TABLE CONTIENE_SERVICIO 		CASCADE CONSTRAINTS;
DROP TABLE CORREO_PERSONAJ 			CASCADE CONSTRAINTS;
DROP TABLE CORREO_PERSONAN 			CASCADE CONSTRAINTS;
DROP TABLE VENDE 					CASCADE CONSTRAINTS;


CREATE TABLE PERSONA_NATURAL
(DNI                NUMBER(8)       PRIMARY KEY                                 ,
GENERO              VARCHAR2(9)                                                 ,
DIRECCION           VARCHAR2(50)                                                ,
FECHA_NACIMIENTO    DATE                                                        ,
NOMBRES             VARCHAR2(25)    NOT NULL                                    ,
APELLIDOS           VARCHAR2(25)                                                );

CREATE TABLE SERVICIO
(CODIGO_SERVICIO    NUMBER(8)       PRIMARY KEY                                 ,
NOMBRE              VARCHAR2(25)    NOT NULL                                    ,
DESCRIPCION         VARCHAR2(50)    NOT NULL                                    ,
PRECIO_VENTA        NUMBER(6,2)     NOT NULL                                    );

CREATE TABLE MARCA
(CODIGO_MARCA       NUMBER(8)       PRIMARY KEY                                 ,
NOMBRE              VARCHAR2(25)    UNIQUE                                      ,
DESCRIPCION         VARCHAR2(50)                                                );

CREATE TABLE PERSONA_JURIDICA
(RUC                NUMBER(11)      PRIMARY KEY                                 ,
PAIS                VARCHAR2(12)    NOT NULL                                    ,
DIRECCION           VARCHAR2(50)    NOT NULL                                    ,
TIPO_EMPRESA        VARCHAR2(10)    NOT NULL                                    ,
NOMBRE_EMPRESA      VARCHAR2(25)    NOT NULL                                    ,
DNI                 NUMBER(8)       NOT NULL REFERENCES PERSONA_NATURAL         );

CREATE TABLE PRODUCTO
(CODIGO_PRODUCTO    NUMBER(8)       PRIMARY KEY                                 ,
DESCRIPCION         VARCHAR2(50)    NOT NULL                                    ,
CARACT              VARCHAR2(50)     NOT NULL                                    ,
UNID_MEDIDA         VARCHAR2(10)     NOT NULL                                    ,
PRECIOVENTASOL      NUMBER(10,2)     NOT NULL                                    ,
CANT_DISPO          NUMBER(10,2)    DEFAULT 0                                   ,    
CST_TOT_DOLAR       NUMBER(10,2)    DEFAULT 0                                   ,
CODIGO_MARCA        NUMBER(8)       NOT NULL REFERENCES MARCA                   );
CREATE TABLE CLIENTE
(COD                NUMBER(8)       PRIMARY KEY                                 );

CREATE TABLE PERSNAT_CLIENTE
(COD                NUMBER(8)       REFERENCES CLIENTE                          ,
DNI                 NUMBER(8)       REFERENCES PERSONA_NATURAL                  ,
PRIMARY             KEY(COD,DNI)                                                );

CREATE TABLE PERSJUR_CLIENTE
(COD                NUMBER(8)       REFERENCES CLIENTE                          ,
RUC                 NUMBER(11)      REFERENCES PERSONA_JURIDICA                  ,
PRIMARY             KEY(COD,RUC)                                                );

CREATE TABLE TRABAJADOR
(CODIGO_TRABAJADOR  NUMBER(8)       PRIMARY KEY                                 ,
DNI                 NUMBER(8)       NOT NULL REFERENCES PERSONA_NATURAL         ,
FECHA_INICIO        DATE                                                        ,
SALARIO             NUMBER(10,2)     NOT NULL                                    ,
CARGO               VARCHAR2(10)     NOT NULL                                    ,
CODIGO_SUPERVISOR   NUMBER(8)       REFERENCES TRABAJADOR                       );

CREATE TABLE PEDIDO
(NRO_COMPROBANTE    NUMBER(8)       PRIMARY KEY                                 ,
TIPO_COMPROBANTE    VARCHAR2(7)     NOT NULL                                    ,
MONTO               NUMBER(10,2)    NOT NULL                                    ,
FECHA_HORA          DATE            NOT NULL                                    ,
ESTADO              VARCHAR2(10)                                                ,
CODIGO_TRABAJADOR   NUMBER(8)       NOT NULL REFERENCES TRABAJADOR              ,
COD_CLIENTE         NUMBER(8)       REFERENCES CLIENTE                          );

CREATE TABLE PROVEEDOR
(CODIGO_PROVEEDOR   NUMBER(8)       PRIMARY KEY                                 ,
RUC                 NUMBER(11)      NOT NULL REFERENCES PERSONA_JURIDICA        );

CREATE TABLE TELEFONO_PERSONA_N
(TELEFONO           NUMBER(11)                                                  ,
DNI                 NUMBER(8)       REFERENCES PERSONA_NATURAL                  ,
PRIMARY             KEY(TELEFONO,DNI)                                           );

CREATE TABLE TELEFONO_PERSONA_J
(TELEFONO           NUMBER(11)                                                  ,
RUC                 NUMBER(11)      REFERENCES PERSONA_JURIDICA                 ,
PRIMARY             KEY(TELEFONO,RUC)                                           );

CREATE TABLE CONTIENE_PRODUCTO
(NRO_COMPROBANTE    NUMBER(8)       REFERENCES PEDIDO                           ,
CODIGO_PRODUCTO     NUMBER(8)       REFERENCES PRODUCTO                         ,
CANTIDAD            NUMBER(8)                                                   ,
CST_CMPR_DLR_UNIT   NUMBER(10,2)                                                ,
PCR_VNT_SOL_UNIT    NUMBER(10,2)                                                 ,
PRIMARY             KEY (NRO_COMPROBANTE,CODIGO_PRODUCTO)                       );

CREATE TABLE VENDE
(CODIGO_PRODUCTO    NUMBER(8)       REFERENCES PRODUCTO                         ,
COMPROBANTE         VARCHAR2(11)    NOT NULL                                    ,
CODIGO_PROVEEDOR    NUMBER(8)       REFERENCES PROVEEDOR                        ,
COSTODOLAR          NUMBER(3,2)     NOT NULL                                    ,
FECHA_ADQUI         DATE                                                        ,
CANTIDAD            NUMBER (3)      NOT NULL                                    ,
PRIMARY             KEY(CODIGO_PRODUCTO,CODIGO_PROVEEDOR,COMPROBANTE)           );

CREATE TABLE CORREO_PERSONAJ
(CORREO             VARCHAR2(50)     NOT NULL                                    ,
RUC NUMBER(11)      REFERENCES      PERSONA_JURIDICA                            ,
PRIMARY             KEY(CORREO,RUC)                                             );

CREATE TABLE CORREO_PERSONAN
(CORREO             VARCHAR2(50)     NOT NULL                                    ,
DNI                 NUMBER(11)      REFERENCES PERSONA_NATURAL                  ,
PRIMARY             KEY(CORREO,DNI)                                             );

CREATE TABLE CONTIENE_SERVICIO
(NRO_COMPROBANTE    NUMBER(8)       REFERENCES PEDIDO                           ,
CODIGO_SERVICIO     NUMBER(8)       REFERENCES SERVICIO                         ,
CANTIDAD            NUMBER(8)                                                   ,
PRIMARY             KEY (NRO_COMPROBANTE,CODIGO_SERVICIO)                       );

--Creacion de elementos base
INSERT      INTO     MARCA               VALUES      (00000000, 'BASE', 'BASE');
INSERT      INTO     PRODUCTO            VALUES      (00000000,'BASE','BASE','BASE',0.00,0,0.00,00000000);
INSERT      INTO     PERSONA_NATURAL     VALUES      (00000000,'BASE','BASE','01-01-2000','BASE', 'BASE');
INSERT      INTO     PERSONA_JURIDICA    VALUES      (00000000000,'BASE','BASE', 'BASE', 'BASE',00000000);
INSERT      INTO     PROVEEDOR           VALUES      (00000000, 00000000000);
INSERT      INTO     CLIENTE             VALUES      (00000000);
INSERT      INTO     TRABAJADOR          VALUES      (00000000,00000000,'01-01-2000',000.00,'BASE',NULL);
INSERT      INTO     SERVICIO            VALUES      (00000000,'BASE','BASE',0.00);
INSERT      INTO     PERSNAT_CLIENTE     VALUES      (00000000,00000000);
INSERT      INTO     PERSJUR_CLIENTE     VALUES      (00000000,00000000000);
------------------------------------------------------------------------------------------------------------------------------------------------------
INSERT      INTO     PERSONA_NATURAL     VALUES      (73195187,'MASCULINO','CALLE ABC 1234','26-05-2002','MATIAS RICARDO', 'VILLANUEVA PAZ');
INSERT      INTO     PERSONA_NATURAL     VALUES      (73281283,'MASCULINO','CALLE CDE 567','20-12-2001','FRANCO LEONARDO', 'MARQUEZ VELASQUEZ');
INSERT      INTO     SERVICIO            VALUES      (11112222,'ANILLADO','CUADERNOS',1.50);
INSERT      INTO     PERSONA_JURIDICA    VALUES      (12345678991,'PERU','CALLE LOL 43', 'IRL', 'WILLY SA',73281283);
INSERT      INTO     PERSONA_JURIDICA    VALUES      (98765432111,'PERU','CALLE SAL 222', 'IRL', 'Mar SA',73281283);
INSERT      INTO     TRABAJADOR          VALUES      (12345678,73195187,'10-10-2020',100.20,'CAJERO',NULL);
INSERT      INTO     PROVEEDOR           VALUES      (15825364, 12345678991);
INSERT      INTO     MARCA               VALUES      (11000000, 'fRANCO', 'mARQUEZ');
INSERT      INTO     MARCA               VALUES      (100001, 'DAS', 'Rapidas');
INSERT      INTO     CLIENTE             VALUES      (11223344);
INSERT      INTO     CLIENTE             VALUES      (11223341);
INSERT      INTO     PERSNAT_CLIENTE     VALUES      (11223344,73195187);
INSERT      INTO     PERSJUR_CLIENTE     VALUES      (11223341,98765432111);
INSERT      INTO     PRODUCTO            VALUES      (10000000,'Juguete','Caract','unidad',1.50,20,0.00,11000000);

SELECT * FROM SERVICIO;
--DADO UN DNI QUE SE MUESTREN TODAS LAS MARCAS CONSUMIDAS POR EL CLIENTE

SELECT M.NOMBRE
FROM 
MARCA M, PEDIDO PE, PRODUCTO P, CLIENTE C, PERSONA_NATURAL PN, PERSNAT_CLIENTE PC, CONTIENE_PRODUCTO COP
WHERE 
PN.DNI = PC.DNI
AND PC.COD = C.COD
AND PE.COD_CLIENTE = C.COD
AND COP.CODIGO_PRODUCTO = P.CODIGO_PRODUCTO
AND P.CODIGO_MARCA = M.CODIGO_MARCA
AND PC.DNI =10101010;
INSERT      INTO     PERSONA_NATURAL     VALUES      (10101010,'FEMENINO','CALLE ASA 21','01-01-2005','PEDRO PICA', 'PIEDRA SEGUDNO');
INSERT      INTO     CLIENTE             VALUES      (2626);
INSERT      INTO     PERSNAT_CLIENTE     VALUES      (2626,10101010);
INSERT      INTO     CONTIENE_PRODUCTO     VALUES      (4,10000000,2,4.10,30.00);


SELECT * FROM TRABAJADOR;
BEGIN
    DBMS_OUTPUT.PUT_LINE(ELM_PN_DNI(73281283));
END;
/*Los datos de un cliente, proveedor o empleado podrán ser modificados o eliminados
en su totalidad (solo administrador) en cualquier momento.*/
/*SE REEMPLAZAN TODOS LOS PEDIDOS PERTENECIENTES A UN CLIENTE HACIA EL CLIENTE MODELO CON CODIGO DE CLIENTE NÚMERO 00 000 000 -DEFAULT*/
/*REEMPLAZAR PEDIDOS CON CLIENTE BASE*/
CREATE OR REPLACE PROCEDURE RMPL_PED_CLI_BASE(
COD_CLI_RMPL            CLIENTE.COD%TYPE,
COD_CLI_NUEVO_OPC   IN  CLIENTE.COD%TYPE DEFAULT 00000000)
IS
BEGIN
    UPDATE PEDIDO SET COD_CLIENTE=COD_CLI_NUEVO_OPC WHERE COD_CLIENTE = COD_CLI_RMPL;
END;
--------------------------------------------------------------------------------------------------------------------------------------------------
/*DNI-DNI*/
CREATE OR REPLACE FUNCTION RMPL_PED_CLI_DNI_2_DNI_FUNC(
    DNI_CLI_RMPL            PERSONA_NATURAL.DNI%TYPE,
    DNI_CLI_NUEVO_OPC   IN  PERSONA_NATURAL.DNI%TYPE DEFAULT 00000000)
RETURN NUMBER
AS
    CONT_ORIGEN     NUMBER;
    CONT_DESTINO    NUMBER;
    CODIGO_ORIGEN   PERSNAT_CLIENTE.COD%TYPE;
    CODIGO_DESTINO  PERSNAT_CLIENTE.COD%TYPE;
BEGIN
    SELECT COUNT(*) INTO CONT_ORIGEN FROM PERSONA_NATURAL WHERE DNI=DNI_CLI_RMPL;
    IF(CONT_ORIGEN=0)THEN
        RETURN 2;
    END IF;
    SELECT COUNT(*) INTO CONT_DESTINO FROM PERSONA_NATURAL WHERE DNI=DNI_CLI_NUEVO_OPC;
    IF(CONT_DESTINO=0)THEN
        RETURN 3;
    END IF;
    DBMS_OUTPUT.PUT_LINE(CREAR_CLIENTE_NATURAL(DNI_CLI_RMPL));
    DBMS_OUTPUT.PUT_LINE(CREAR_CLIENTE_NATURAL(DNI_CLI_NUEVO_OPC));
    SELECT COD INTO CODIGO_ORIGEN FROM PERSNAT_CLIENTE WHERE DNI=DNI_CLI_RMPL;
    SELECT COD INTO CODIGO_DESTINO FROM PERSNAT_CLIENTE WHERE DNI=DNI_CLI_NUEVO_OPC;
    UPDATE PEDIDO SET COD_CLIENTE=CODIGO_DESTINO WHERE COD_CLIENTE=CODIGO_ORIGEN;
    RETURN 1;
END;
/*DNI-RUC*/
CREATE OR REPLACE FUNCTION RMPL_PED_CLI_DNI_2_RUC_FUNC(
    DNI_CLI_RMPL            PERSONA_NATURAL.DNI%TYPE,
    RUC_CLI_NUEVO_OPC   IN  PERSONA_JURIDICA.RUC%TYPE DEFAULT 00000000000)
RETURN NUMBER
AS
    CONT_ORIGEN     NUMBER;
    CONT_DESTINO    NUMBER;
    CODIGO_ORIGEN   PERSNAT_CLIENTE.COD%TYPE;
    CODIGO_DESTINO  PERSNAT_CLIENTE.COD%TYPE;
BEGIN
    SELECT COUNT(*) INTO CONT_ORIGEN FROM PERSONA_NATURAL WHERE DNI=DNI_CLI_RMPL;
    IF(CONT_ORIGEN=0)THEN
        RETURN 2;
    END IF;
    SELECT COUNT(*) INTO CONT_DESTINO FROM PERSONA_JURIDICA WHERE RUC=RUC_CLI_NUEVO_OPC;
    IF(CONT_DESTINO=0)THEN
        RETURN 3;
    END IF;
    DBMS_OUTPUT.PUT_LINE(CREAR_CLIENTE_NATURAL(DNI_CLI_RMPL));
    DBMS_OUTPUT.PUT_LINE(CREAR_CLIENTE_JURIDICO(RUC_CLI_NUEVO_OPC));
    SELECT COD INTO CODIGO_ORIGEN FROM PERSNAT_CLIENTE WHERE DNI=DNI_CLI_RMPL;
    SELECT COD INTO CODIGO_DESTINO FROM PERSJUR_CLIENTE WHERE RUC=RUC_CLI_NUEVO_OPC;
    UPDATE PEDIDO SET COD_CLIENTE=CODIGO_DESTINO WHERE COD_CLIENTE=CODIGO_ORIGEN;
    RETURN 1;
END;
/*RUC-DNI*/
CREATE OR REPLACE FUNCTION RMPL_PED_CLI_RUC_2_DNI_FUNC(
    RUC_CLI_RMPL            PERSONA_JURIDICA.RUC%TYPE,
    DNI_CLI_NUEVO_OPC   IN  PERSONA_NATURAL.DNI%TYPE DEFAULT 00000000)
RETURN NUMBER
AS
    CONT_ORIGEN     NUMBER;
    CONT_DESTINO    NUMBER;
    CODIGO_ORIGEN   PERSNAT_CLIENTE.COD%TYPE;
    CODIGO_DESTINO  PERSNAT_CLIENTE.COD%TYPE;
BEGIN
    SELECT COUNT(*) INTO CONT_ORIGEN FROM PERSONA_JURIDICA WHERE RUC=RUC_CLI_RMPL;
    IF(CONT_ORIGEN=0)THEN
        RETURN 2;
    END IF;
    SELECT COUNT(*) INTO CONT_DESTINO FROM PERSONA_NATURAL WHERE DNI=DNI_CLI_NUEVO_OPC;
    IF(CONT_DESTINO=0)THEN
        RETURN 3;
    END IF;
    DBMS_OUTPUT.PUT_LINE(CREAR_CLIENTE_JURIDICO(RUC_CLI_RMPL));
    DBMS_OUTPUT.PUT_LINE(CREAR_CLIENTE_NATURAL(DNI_CLI_NUEVO_OPC));
    SELECT COD INTO CODIGO_ORIGEN FROM PERSJUR_CLIENTE WHERE RUC=RUC_CLI_RMPL;
    SELECT COD INTO CODIGO_DESTINO FROM PERSNAT_CLIENTE WHERE DNI=DNI_CLI_NUEVO_OPC;
    UPDATE PEDIDO SET COD_CLIENTE=CODIGO_DESTINO WHERE COD_CLIENTE=CODIGO_ORIGEN;
    RETURN 1;
END;
/*RUC-RUC*/
CREATE OR REPLACE FUNCTION RMPL_PED_CLI_RUC_2_RUC_FUNC(
    RUC_CLI_RMPL            PERSONA_JURIDICA.RUC%TYPE,
    RUC_CLI_NUEVO_OPC   IN  PERSONA_JURIDICA.RUC%TYPE DEFAULT 00000000000)
RETURN NUMBER
AS
    CONT_ORIGEN     NUMBER;
    CONT_DESTINO    NUMBER;
    CODIGO_ORIGEN   PERSNAT_CLIENTE.COD%TYPE;
    CODIGO_DESTINO  PERSNAT_CLIENTE.COD%TYPE;
BEGIN
    SELECT COUNT(*) INTO CONT_ORIGEN FROM PERSONA_JURIDICA WHERE RUC=RUC_CLI_RMPL;
    IF(CONT_ORIGEN=0)THEN
        RETURN 2;
    END IF;
    SELECT COUNT(*) INTO CONT_DESTINO FROM PERSONA_JURIDICA WHERE RUC=RUC_CLI_NUEVO_OPC;
    IF(CONT_DESTINO=0)THEN
        RETURN 3;
    END IF;
    DBMS_OUTPUT.PUT_LINE(CREAR_CLIENTE_JURIDICO(RUC_CLI_RMPL));
    DBMS_OUTPUT.PUT_LINE(CREAR_CLIENTE_JURIDICO(RUC_CLI_NUEVO_OPC));
    SELECT COD INTO CODIGO_ORIGEN FROM PERSJUR_CLIENTE WHERE RUC=RUC_CLI_RMPL;
    SELECT COD INTO CODIGO_DESTINO FROM PERSJUR_CLIENTE WHERE RUC=RUC_CLI_NUEVO_OPC;
    UPDATE PEDIDO SET COD_CLIENTE=CODIGO_DESTINO WHERE COD_CLIENTE=CODIGO_ORIGEN;
    RETURN 1;
END;


----------------------------------------------------------------------------------------------------------------------------------------------------

/*SE REEMPLAZAN TODOS LOS PEDIDOS PERTENECIENTES A UN TRABAJADOR HACIA EL TRABAJADOR MODELO CON CODIGO DE TRABAJADOR NÚMERO 00 000 000 -DEFAULT*/
/*REEMPLAZAR PEDIDOS CON TRABAJADOR BASE*/
CREATE OR REPLACE PROCEDURE RMPL_PED_TRA_BASE(
COD_TRA_RMPL            TRABAJADOR.CODIGO_TRABAJADOR%TYPE,
COD_TRA_NUEVO_OPC   IN  TRABAJADOR.CODIGO_TRABAJADOR%TYPE DEFAULT 00000000)
IS
BEGIN
    UPDATE PEDIDO SET CODIGO_TRABAJADOR=COD_TRA_NUEVO_OPC WHERE CODIGO_TRABAJADOR = COD_TRA_RMPL;
END;
/*SE REEMPLAZAN TODAS LAS VENTAS PERTENECIENTES A UN PROVEEDOR HACIA EL PROVEEDOR MODELO CON CODIGO DE PROVEEDOR NÚMERO 00 000 000 -DEFAULT*/
/*REEMPLAZAR VENTAS CON PROVEEDOR BASE*/
CREATE OR REPLACE PROCEDURE RMPL_VNT_PRV_BASE(
COD_PRV_RMPL            PROVEEDOR.CODIGO_PROVEEDOR%TYPE,
COD_PRV_NUEVO_OPC   IN  PROVEEDOR.CODIGO_PROVEEDOR%TYPE DEFAULT 00000000)
IS
BEGIN
    UPDATE VENDE SET CODIGO_PROVEEDOR=COD_PRV_NUEVO_OPC WHERE CODIGO_PROVEEDOR = COD_PRV_RMPL;
END;
/*SE REEMPLAZARÁ EL JEFE CON CODIGO *DATO* HACIA EL JEFE BASE CON CODIGO 00000000 -DEFAULT */
/*REEMPLAZAR EL JEFE CON EL JEFE BASE*/
CREATE OR REPLACE PROCEDURE RMPL_JEF_JEF_BASE(
COD_JEF_RMPL            TRABAJADOR.CODIGO_SUPERVISOR%TYPE, 
COD_JEF_NUEVO_OPC   IN  TRABAJADOR.CODIGO_SUPERVISOR%TYPE DEFAULT 00000000)
IS
BEGIN
    UPDATE TRABAJADOR SET CODIGO_SUPERVISOR=COD_JEF_NUEVO_OPC WHERE CODIGO_SUPERVISOR=COD_JEF_RMPL;
END;

/*AQUÍ SE ELIMINA LA TABLA QUE RELACIONA A CLIENTE CON PN POR MEDIO DEL CODIGO DE CLIENTE*/
CREATE OR REPLACE PROCEDURE ELM_CODCLI_CLI_PN(COD_CLI_DATO CLIENTE.COD%TYPE)
IS
BEGIN
    /*EN ESTE CASO, AL TRATARSE DE UNA TABLA DE 1*1, SOLO SE ELIMINARÁ UN DATO*/
    /*LAS RESTRICCIONES PARA QUE SOLO UNA PERNAT SEA CONECTADA A UN CLIENTE ESTÁ DEFINIDA EN EL INGRESO DE DATOS*/
    DELETE FROM PERSNAT_CLIENTE WHERE COD = COD_CLI_DATO;
END;
/*AQUÍ SE ELIMINA LA TABLA QUE RELACIONA A CLIENTE CON PN POR MEDIO DEL DNI DE LA PN*/
CREATE OR REPLACE PROCEDURE ELM_CODPN_CLI_PN(DNI_PN_DATO PERSONA_NATURAL.DNI%TYPE)
IS
BEGIN
    /*EN ESTE CASO, AL TRATARSE DE UNA TABLA DE 1*1, SOLO SE ELIMINARÁ UN DATO*/
    /*LAS RESTRICCIONES PARA QUE SOLO UNA PERNAT SEA CONECTADA A UN CLIENTE ESTÁ DEFINIDA EN EL INGRESO DE DATOS*/
    DELETE FROM PERSNAT_CLIENTE WHERE DNI = DNI_PN_DATO;
END;

/*AQUÍ SE ELIMINA LA TABLA QUE RELACIONA A CLIENTE CON PJ POR MEDIO DEL CODIGO DE CLIENTE*/
CREATE OR REPLACE PROCEDURE ELM_CODCLI_CLI_PJ(COD_CLI_DATO CLIENTE.COD%TYPE)
IS
BEGIN
    /*EN ESTE CASO, AL TRATARSE DE UNA TABLA DE 1*1, SOLO SE ELIMINARÁ UN DATO*/
    /*LAS RESTRICCIONES PARA QUE SOLO UNA PERJUR SEA CONECTADA A UN CLIENTE ESTÁ DEFINIDA EN EL INGRESO DE DATOS*/
    DELETE FROM PERSJUR_CLIENTE WHERE COD = COD_CLI_DATO;
END;
/*AQUÍ SE ELIMINA LA TABLA QUE RELACIONA A CLIENTE CON PN POR MEDIO DEL DNI DE LA PN*/
CREATE OR REPLACE PROCEDURE ELM_CODPJ_CLI_PN(RUC_PJ_DATO PERSONA_JURIDICA.RUC%TYPE)
IS
BEGIN
    /*EN ESTE CASO, AL TRATARSE DE UNA TABLA DE 1*1, SOLO SE ELIMINARÁ UN DATO*/
    /*LAS RESTRICCIONES PARA QUE SOLO UNA PERJUR SEA CONECTADA A UN CLIENTE ESTÁ DEFINIDA EN EL INGRESO DE DATOS*/
    DELETE FROM PERSJUR_CLIENTE WHERE RUC = RUC_PJ_DATO;
END;


/*------------------------------------------------ELIMINACION DE CLIENTE------------------------------------------------*/
/*SE ELIMINAN LAS TABLAS QUE SE RELACIONAN CON CLIENTE*/
CREATE OR REPLACE PROCEDURE ELM_CLI_COD(CODIGO_CLIENTE_DATO CLIENTE.COD%TYPE)
IS
BEGIN
    ELM_CODCLI_CLI_PN(CODIGO_CLIENTE_DATO);
    ELM_CODCLI_CLI_PJ(CODIGO_CLIENTE_DATO);
    RMPL_PED_CLI_BASE(CODIGO_CLIENTE_DATO);
    DELETE FROM CLIENTE WHERE COD = CODIGO_CLIENTE_DATO;
END;
/*SE ELIMINA UN CLIENTE CON DNI COMO ARGUMENTO*/                                /*MATIAS TRABAJA CON ESTA*/
CREATE OR REPLACE FUNCTION ELM_CLI_DNI(DNI_CLIENTE_DATO PERSNAT_CLIENTE.DNI%TYPE)
RETURN NUMBER
AS
    CODIGO_CLIENTE_DATO CLIENTE.COD%TYPE;
    CONT NUMBER;
BEGIN
    SELECT COD INTO CODIGO_CLIENTE_DATO FROM PERSNAT_CLIENTE WHERE DNI = DNI_CLIENTE_DATO;  /*SI NO ENCUENTRA VA A EXCEPTION*/
    SELECT COUNT(*) INTO CONT FROM CLIENTE WHERE COD=CODIGO_CLIENTE_DATO;
    IF(CONT=0) THEN
        RETURN 1;                                               /*SIGNIFICA QUE NO EXISTE EL CLIENTE*/
    END IF;
    IF(CODIGO_CLIENTE_DATO!=00000000) THEN
        ELM_CLI_COD(CODIGO_CLIENTE_DATO);
        RETURN 2;                                               /*SIGNIFICA QUE SE ELIMINO EL CLIENTE*/
    END IF;
    RETURN 3;                                                   /*SIGNIFICA QUE NO SE PUDO BORRAR PORQUE ES EL CLIENTE BASE DE CODIGO 0000 0000*/
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RETURN 4;                                               /*SIGNIFICA QUE NO EXISTE LA PERSONA NATURAL*/
    WHEN OTHERS THEN
        RETURN 5;                                               /*SIGNIFICA QUE SE GENERO OTRO ERROR*/
END;
/*SE ELIMINA UN CLIENTE CON RUC COMO ARGUMENTO*/                                /*MATIAS TRABAJA CON ESTA*/
CREATE OR REPLACE FUNCTION ELM_CLI_RUC(RUC_CLIENTE_DATO PERSJUR_CLIENTE.RUC%TYPE)
RETURN NUMBER
AS
    CODIGO_CLIENTE_DATO CLIENTE.COD%TYPE;
    CONT NUMBER;
BEGIN
    SELECT COD INTO CODIGO_CLIENTE_DATO FROM PERSJUR_CLIENTE WHERE RUC = RUC_CLIENTE_DATO;  /*SI NO ENCUENTRA VA A EXCEPTION*/
    SELECT COUNT(*) INTO CONT FROM CLIENTE WHERE COD=CODIGO_CLIENTE_DATO;
    IF(CONT=0) THEN
        RETURN 1;                                               /*SIGNIFICA QUE NO EXISTE EL CLIENTE*/
    END IF;
    IF(CODIGO_CLIENTE_DATO!=00000000) THEN
        ELM_CLI_COD(CODIGO_CLIENTE_DATO);
        RETURN 2;                                               /*SIGNIFICA QUE SE ELIMINO EL CLIENTE*/
    END IF;
    RETURN 3;                                                   /*SIGNIFICA QUE NO SE PUDO BORRAR PORQUE ES EL CLIENTE BASE DE CODIGO 0000 0000*/
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RETURN 4;                                               /*SIGNIFICA QUE NO EXISTE LA PERSONA JURIDICA*/
    WHEN OTHERS THEN
        RETURN 5;                                               /*SIGNIFICA QUE SE GENERO OTRO ERROR*/
END;

/*-----------------------------------------------ELIMINACION DE TRABAJADOR-----------------------------------------------*/
                                                                                /*MATIAS TRABAJA CON ESTA*/
CREATE OR REPLACE FUNCTION ELM_TRA_DNI(DNI_TRABAJADOR_DATO TRABAJADOR.DNI%TYPE)
RETURN NUMBER
AS
    CODIGO_TRABAJADOR_DATO TRABAJADOR.CODIGO_TRABAJADOR%TYPE;
    CONT NUMBER;
BEGIN
    SELECT CODIGO_TRABAJADOR INTO CODIGO_TRABAJADOR_DATO FROM TRABAJADOR WHERE DNI=DNI_TRABAJADOR_DATO;
    SELECT COUNT(*) INTO CONT FROM TRABAJADOR WHERE CODIGO_TRABAJADOR=CODIGO_TRABAJADOR_DATO;
    IF(CONT=0)THEN
        RETURN 1;                                                               /*SIGNIFICA QUE NO EXISTE EL TRABAJADOR*/
    END IF;
    IF(CODIGO_TRABAJADOR_DATO !=00000000) THEN
        RMPL_JEF_JEF_BASE(CODIGO_TRABAJADOR_DATO);
        RMPL_PED_TRA_BASE(CODIGO_TRABAJADOR_DATO);
        DELETE FROM TRABAJADOR WHERE CODIGO_TRABAJADOR=CODIGO_TRABAJADOR_DATO;
        RETURN 2;                                                               /*SIGNIFICA QUE SE ELIMINO EL TRABAJADOR*/
    END IF;
    RETURN 3;                                                                   /*SIGNIFICA QUE NO SE PUEDO ELIMINAR PORQUE ES EL TRABAJADOR BASE 000 0000*/
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RETURN 4;                                                               /*SIGNIFICA QUE NO EXISTE LA PERSONA NATURAL*/
    WHEN OTHERS THEN
        RETURN 5;                                                               /*SIGNIFICA QUE SE GENERO OTRO ERROR*/
END;

/*-----------------------------------------------ELIMINACION DE PROVEEDOR------------------------------------------------*/
                                                                                /*MATIAS TRABAJA CON ESTA*/
CREATE OR REPLACE FUNCTION ELM_PRV_RUC(RUC_PROVEEDOR_DATO PROVEEDOR.CODIGO_PROVEEDOR%TYPE)
RETURN NUMBER
AS
    CODIGO_PROVEEDOR_DATO PROVEEDOR.CODIGO_PROVEEDOR%TYPE;
    CONT NUMBER;
BEGIN
    SELECT CODIGO_PROVEEDOR INTO CODIGO_PROVEEDOR_DATO FROM PROVEEDOR WHERE RUC=RUC_PROVEEDOR_DATO;
    SELECT COUNT(*) INTO CONT FROM PROVEEDOR WHERE CODIGO_PROVEEDOR=CODIGO_PROVEEDOR_DATO;
    IF(CONT=0)THEN
        RETURN 1;                                                               /*SIGNIFICA QUE NO EXISTE EL PROVEEDOR*/
    END IF;
    IF(CODIGO_PROVEEDOR_DATO!=00000000)THEN
        RMPL_VNT_PRV_BASE(CODIGO_PROVEEDOR_DATO);
        DELETE FROM PROVEEDOR WHERE CODIGO_PROVEEDOR=CODIGO_PROVEEDOR_DATO;
        RETURN 2;                                                               /*SIGNIFICA QUE SE ELIMINO EL PROVEEDOR*/
    END IF;
    RETURN 3;                                                                   /*SIGNIFICA QUE NO SE ELIMINÓ PORQUE ERA EL PROVEEDOR BASE DE CODIGO 0000 0000*/
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RETURN 4;                                                               /*SIGNIFICA QUE NO EXISTE LA PERSONA JURIDICA*/
    WHEN OTHERS THEN
        RETURN 5;                                                               /*SIGNIFICA QUE SE GENERO OTRO ERROR*/
END;

/*-----------------------------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------ELIMINACION DE PADRES-------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------*/

/*SE ELIMINA UNA PERSONA JURIDICA Y SE PASA UN RUC COMO ARGUMENTO*/
CREATE OR REPLACE FUNCTION ELM_PJ_RUC(RUC_PJ_DATO PERSONA_JURIDICA.RUC%TYPE)
RETURN NUMBER
IS
    CONT                        NUMBER;
BEGIN
    SELECT COUNT(*) INTO CONT FROM PERSONA_JURIDICA WHERE RUC=RUC_PJ_DATO;
    IF(CONT=0)THEN
        RETURN 1;                                                               /*SIGNIFICA QUE NO EXISTE LA PJ*/
    END IF;
    IF(RUC_PJ_DATO!=00000000000) THEN
        DBMS_OUTPUT.PUT_LINE(ELM_CLI_RUC(RUC_PJ_DATO));       /*SE ELIMINAN LOS CLIENTES SI EXISTIERAN*/
        DBMS_OUTPUT.PUT_LINE(ELM_PRV_RUC(RUC_PJ_DATO));       /*SE ELIMINAN LOS PROVEEDORES SI EXISTIERAN*/
        DELETE FROM CORREO_PERSONAJ WHERE RUC = RUC_PJ_DATO;
        DELETE FROM TELEFONO_PERSONA_J WHERE RUC = RUC_PJ_DATO;
        DELETE FROM PERSONA_JURIDICA WHERE RUC = RUC_PJ_DATO;
        RETURN 2;                                                               /*SIGNIFICA QUE SÍ BORRASTE A LA PERSONA J*/
    END IF;
    RETURN 3;                                                                   /*SIGNIFI                                                                /*SIGNIFICA QUE NO SE ELIMINÓ PORQUE ERA LA PJ BASE DE RUC 000 0000 0000*/
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RETURN 4;
    WHEN OTHERS THEN
        RETURN 5;                                                               /*SIGNIFICA QUE SE GENERO OTRO ERROR*/
END;
/*SE ELIMINA UNA PERSONA NATURAL Y SE ELIMINA LA REPRESENTACIÓN CON PERSONA JURÍDICA*/
CREATE OR REPLACE FUNCTION ELM_PN_DNI(DNI_PN_DATO PERSONA_NATURAL.DNI%TYPE)
RETURN NUMBER
IS
    CONT                        NUMBER;
BEGIN
    SELECT COUNT(*) INTO CONT FROM PERSONA_NATURAL WHERE DNI = DNI_PN_DATO;                                                             /*SIGNIFICA QUE SE GENERO OTRO ERROR*/
    IF(CONT=0)THEN
        RETURN 1;
    END IF;
    IF(DNI_PN_DATO!=00000000)THEN
        DBMS_OUTPUT.PUT_LINE(ELM_CLI_DNI(DNI_PN_DATO));
        DBMS_OUTPUT.PUT_LINE(ELM_TRA_DNI(DNI_PN_DATO));
        UPDATE PERSONA_JURIDICA SET DNI=00000000 WHERE DNI = DNI_PN_DATO;
        DELETE FROM CORREO_PERSONAN WHERE DNI=DNI_PN_DATO;
        DELETE FROM TELEFONO_PERSONA_N WHERE DNI=DNI_PN_DATO;
        DELETE FROM PERSONA_NATURAL WHERE DNI=DNI_PN_DATO;
        RETURN 2;
    END IF;
    RETURN 3;
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RETURN 4;
    WHEN OTHERS THEN
        RETURN 5;
END;
SELECT * FROM PERSONA_NATURAL;
BEGIN 
     DBMS_OUTPUT.PUT_LINE('ANTES');
     DBMS_OUTPUT.PUT_LINE(ELM_PN_DNI(73195187));
     DBMS_OUTPUT.PUT_LINE('DESPUES');
END;

/*-----------------------------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------ELIMINACION DE LÓGICA DEL NEGOCIO-------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------*/

/*CAMBIAR PRODUCTO A PRODUCTO GENERICO DE UNA COMPRA A PROVEEDOR*/
/*REEMPLAZAR PRODUCTO DE COMPRA A PRODUCTO BASE*/
CREATE OR REPLACE PROCEDURE RMPL_PRD_VNT_PRD_BASE(
COD_PRD_DATO            VENDE.CODIGO_PRODUCTO%TYPE,
COD_PRD_DATO_OPC   IN   VENDE.CODIGO_PRODUCTO%TYPE DEFAULT 00000000)
IS
BEGIN
    UPDATE VENDE SET CODIGO_PRODUCTO = COD_PRD_DATO_OPC WHERE CODIGO_PRODUCTO = COD_PRD_DATO;
END;
/*CAMBIAR UN PRODUCTO A PRODUCTO GENERICO DE UNA VENTA A CLIENTE*/
/*REEMPLAZAR PRODUCTO DE VENTA A PRODUCTO BASE*/
CREATE OR REPLACE PROCEDURE RMPL_PRD_PED_PRD_BASE(
COD_PRD_DATO            CONTIENE_PRODUCTO.CODIGO_PRODUCTO%TYPE,
COD_PRD_DATO_OPC   IN   CONTIENE_PRODUCTO.CODIGO_PRODUCTO%TYPE DEFAULT 00000000)
IS
BEGIN
    UPDATE CONTIENE_PRODUCTO SET CODIGO_PRODUCTO = COD_PRD_DATO_OPC WHERE CODIGO_PRODUCTO = COD_PRD_DATO;
END;
/*ELIMINACIÓN DE PRODUCTO*/
CREATE OR REPLACE FUNCTION ELM_PRD_COD(COD_PRD_DATO PRODUCTO.CODIGO_PRODUCTO%TYPE)
RETURN
    NUMBER
IS
    CONT NUMBER;
BEGIN
    SELECT COUNT(*) INTO CONT FROM PRODUCTO WHERE CODIGO_PRODUCTO=COD_PRD_DATO;
    IF(CONT=0)THEN
        RETURN 1;                                               /*SIGNIFICA QUE NO EXISTE EL CLIENTE*/
    END IF;
    IF(COD_PRD_DATO!=00000000)THEN
        RMPL_PRD_VNT_PRD_BASE(COD_PRD_DATO);
        RMPL_PRD_PED_PRD_BASE(COD_PRD_DATO);
        DELETE FROM PRODUCTO WHERE CODIGO_PRODUCTO = COD_PRD_DATO;
        RETURN 2;                                               /*SE ELIMINÓ SATISFACTORIAMENTE EL PRODUCTO*/
    END IF;
    RETURN 3;                                                   /*SIGNIFICA QUE NO SE BORRÓ PORQUE ERA EL PRODUCTO BASE*/
EXCEPTION
    WHEN OTHERS THEN
        RETURN 5;
END;
BEGIN 
     DBMS_OUTPUT.PUT_LINE('ANTES');
     DBMS_OUTPUT.PUT_LINE(ELM_PRD_COD(10000000));
     DBMS_OUTPUT.PUT_LINE('DESPUES');
END;
/*CAMBIAR SERVICIO A SERVICIO GENERICO*/
CREATE OR REPLACE PROCEDURE RMPL_SRV_PED_BASE(
COD_SRV_DATO            SERVICIO.CODIGO_SERVICIO%TYPE,
COD_SRV_DATO_OPC   IN   SERVICIO.CODIGO_SERVICIO%TYPE DEFAULT 00000000)
IS
BEGIN
    UPDATE CONTIENE_SERVICIO SET CODIGO_SERVICIO = COD_SRV_DATO_OPC WHERE CODIGO_SERVICIO=COD_SRV_DATO;
END;
/*ELIMINACIÓN DE SERVICIO*/
CREATE OR REPLACE FUNCTION ELM_SRV_COD(COD_SRV_DATO SERVICIO.CODIGO_SERVICIO%TYPE)
RETURN
    NUMBER
IS
    CONT NUMBER;
BEGIN
    SELECT COUNT(*) INTO CONT FROM SERVICIO WHERE CODIGO_SERVICIO=COD_SRV_DATO;
    IF(CONT=0)THEN
        RETURN 1;                                               /*SIGNIFICA QUE NO EXISTE EL SERVICIO*/
    END IF;
    IF(COD_SRV_DATO!=00000000)THEN
        RMPL_SRV_PED_BASE(COD_SRV_DATO);
        DELETE FROM SERVICIO WHERE CODIGO_SERVICIO = COD_SRV_DATO;
        RETURN 2;                                               /*SE ELIMINÓ SATISFACTORIAMENTE EL SERVICIO*/
    END IF;
    RETURN 3;                                                   /*SIGNIFICA QUE NO SE BORRÓ PORQUE ERA EL SERVICIO BASE*/
EXCEPTION
    WHEN OTHERS THEN
        RETURN 5;
END;

/*ELIMINACION DE UN PEDIDO*/

/*RETORNAR DINERO DE LA TABLA CONTIENE PRODUCTOS*/
CREATE OR REPLACE PROCEDURE RET_DIN_TOT_DOL_PRD(NRO_CMP_DATO PEDIDO.NRO_COMPROBANTE%TYPE)
IS
    CURSOR DINERO IS
    SELECT 
        CANTIDAD*CST_CMPR_DLR_UNIT AS COSTO_TOTAL, CODIGO_PRODUCTO
    FROM
        CONTIENE_PRODUCTO
    WHERE
        NRO_COMPROBANTE = NRO_CMP_DATO;
BEGIN
    FOR X IN DINERO LOOP
        UPDATE PRODUCTO SET CST_TOT_DOLAR = CST_TOT_DOLAR + X.COSTO_TOTAL WHERE CODIGO_PRODUCTO=X.CODIGO_PRODUCTO;
    END LOOP;
END;


/*ELIMINACION DE PRODUCTOS CONTENIDOS EN UN PEDIDO*/
CREATE OR REPLACE FUNCTION ELM_CONT_PRD_PED(NRO_CMP_DATO PEDIDO.NRO_COMPROBANTE%TYPE)
RETURN NUMBER
IS
    CONT NUMBER;
BEGIN
    SELECT COUNT(*) INTO CONT FROM PEDIDO WHERE NRO_COMPROBANTE=NRO_CMP_DATO;
    IF(CONT=0)THEN
        RETURN 1;               /*NO EXISTE EL PEDIDO BUSCADO*/
    END IF;
    IF(NRO_CMP_DATO!=00000000)THEN
        RET_DIN_TOT_DOL_PRD(NRO_CMP_DATO);
        DELETE CONTIENE_PRODUCTO WHERE NRO_COMPROBANTE=NRO_CMP_DATO;
        DELETE CONTIENE_SERVICIO WHERE NRO_COMPROBANTE=NRO_CMP_DATO;
        DELETE PEDIDO WHERE NRO_COMPROBANTE = NRO_CMP_DATO;
        RETURN 2;               /*FUE ELIMINADO SATISFACTORIAMENTE*/
    END IF;
    RETURN 3;                   /*NO FUE ELIMINADO EL PEDIDO*/
END;

/*ELIMINAR MARCA*/
/*ESTABLECER LA NUEVA MARCA A MARCA GENERICA*/
CREATE OR REPLACE PROCEDURE RMPL_MRC_PRD_MRC(
COD_MRC_DATO        MARCA.CODIGO_MARCA%TYPE,
COD_MRC_DATO_OPC IN MARCA.CODIGO_MARCA%TYPE DEFAULT 00000000
)
IS
BEGIN
    UPDATE PRODUCTO SET CODIGO_MARCA=COD_MRC_DATO_OPC WHERE CODIGO_MARCA=COD_MRC_DATO;
END;
/*ELIMINAR MARCA*/
CREATE OR REPLACE FUNCTION ELM_MRC_COD_MRC(NOM_MRC MARCA.NOMBRE%TYPE)
RETURN NUMBER
IS
    CONT            NUMBER;
    COD_MRC_DATO    MARCA.CODIGO_MARCA%TYPE;
BEGIN
    SELECT COUNT(*) INTO CONT FROM MARCA WHERE NOMBRE=NOM_MRC;
    IF(CONT=1)THEN
        SELECT CODIGO_MARCA INTO COD_MRC_DATO FROM MARCA WHERE NOMBRE=NOM_MRC;
        RMPL_MRC_PRD_MRC(COD_MRC_DATO);
        DELETE FROM MARCA WHERE NOMBRE=NOM_MRC;
        RETURN 2;                   /*SE BORRO LA MARCA*/
    END IF;
    RETURN 1;                       /*NO EXISTE LA MARCA RELACIONADA AL CODIGO DE MARCA*/
EXCEPTION
    WHEN OTHERS THEN
        RETURN 5;                   /*SUCEDIÓN UN ERROR EN GENERAL*/
END;


SELECT PD.* FROM PERSONA_NATURAL PN, PERSNAT_CLIENTE PC, PEDIDO PD WHERE PN.DNI=PC.DNI AND PC.COD=PD.COD_CLIENTE AND PN.DNI= 73195187;
SELECT * FROM TRABAJADOR;

CREATE OR REPLACE FUNCTION ELIM_PROD_PEDIDO(COD PEDIDO.NRO_COMPROBANTE%TYPE,
                                            COD_P PRODUCTO.CODIGO_PRODUCTO%TYPE)
RETURN NUMBER
IS
    CANT NUMBER;
    CST NUMBER;
BEGIN
    SELECT COUNT(*) INTO CANT FROM CONTIENE_PRODUCTO WHERE NRO_COMPROBANTE = COD AND CODIGO_PRODUCTO = COD_P;
    IF CANT > 0 THEN
        SELECT CANTIDAD*-1, CST_CMPR_DLR_UNIT INTO CANT,CST FROM CONTIENE_PRODUCTO WHERE NRO_COMPROBANTE = COD AND CODIGO_PRODUCTO=COD_P;
        ACT_COSTOT_CANT(COD_P,CANT,CST);
        DELETE FROM CONTIENE_PRODUCTO WHERE NRO_COMPROBANTE = COD AND CODIGO_PRODUCTO=COD_P;
        RETURN 1;/*SE ELIMINO LA TUPLA*/
    ELSE
        RETURN 2;/*ALGUNO DE LOS DATOS INGRESADOS NO EXISTE O LA TUPLA EN SI NO LO HACE*/
    END IF;
END ELIM_PROD_PEDIDO;
--INGRESO DE OBJETOS--
CREATE OR REPLACE PROCEDURE INGRESAR_PN (D PERSONA_NATURAL.DNI%TYPE,
                                        NOM IN PERSONA_NATURAL.NOMBRES%TYPE DEFAULT '-',
                                        GEN IN PERSONA_NATURAL.GENERO%TYPE DEFAULT '-',
                                        DIR IN PERSONA_NATURAL.DIRECCION%TYPE DEFAULT '-',
                                        FEC IN PERSONA_NATURAL.FECHA_NACIMIENTO%TYPE DEFAULT '01/01/1970',
                                        APE IN PERSONA_NATURAL.APELLIDOS%TYPE DEFAULT '-')
IS
BEGIN
    INSERT INTO PERSONA_NATURAL VALUES (D,GEN,DIR,FEC,NOM,APE);
END INGRESAR_PN;

CREATE OR REPLACE PROCEDURE INGRESAR_PJ (R PERSONA_JURIDICA.RUC%TYPE,
                                        RAZ PERSONA_JURIDICA.NOMBRE_EMPRESA%TYPE,
                                        TIP PERSONA_JURIDICA.TIPO_EMPRESA%TYPE,
                                        D PERSONA_JURIDICA.DNI%TYPE,
                                        PAI IN PERSONA_JURIDICA.PAIS%TYPE DEFAULT '-',
                                        DIR IN PERSONA_JURIDICA.DIRECCION%TYPE DEFAULT '-')
IS
C NUMBER;
BEGIN
    SELECT COUNT(*) INTO C FROM PERSONA_NATURAL WHERE DNI = D;
    IF C = 0 THEN
        INGRESAR_PN(D);
    END IF;
        INSERT INTO PERSONA_JURIDICA VALUES (R,PAI,DIR,TIP,RAZ,D);
END INGRESAR_PJ;

DROP SEQUENCE COD_CLIENTE;
CREATE SEQUENCE COD_CLIENTE START WITH 100 INCREMENT BY 1;

CREATE OR REPLACE PROCEDURE INGRESAR_CN(D PERSONA_NATURAL.DNI%TYPE)
IS
    COD NUMBER:=COD_CLIENTE.NEXTVAL;
BEGIN
    INSERT INTO CLIENTE VALUES(COD);
    INSERT INTO PERSNAT_CLIENTE VALUES (COD,D);
END INGRESAR_CN;

CREATE OR REPLACE PROCEDURE INGRESAR_CJ(R PERSONA_JURIDICA.RUC%TYPE)
IS
    COD NUMBER:=COD_CLIENTE.NEXTVAL;
BEGIN
    INSERT INTO CLIENTE VALUES(COD);
    INSERT INTO PERSJUR_CLIENTE VALUES (COD,R);
END INGRESAR_CJ;

CREATE OR REPLACE PROCEDURE INGRESAR_CORREO_TEL(TIPO IN NUMBER,                                                  
                                                  C IN VARCHAR2,
                                                  T IN VARCHAR2,
                                                  D IN NUMBER DEFAULT 0,
                                                  R IN NUMBER DEFAULT 0)
IS
BEGIN
IF TIPO = 1 THEN
    INSERT INTO TELEFONO_PERSONA_N VALUES(T,D);
    INSERT INTO CORREO_PERSONAN VALUES(C,D);
ELSE
    INSERT INTO TELEFONO_PERSONA_J VALUES(T,R);
    INSERT INTO CORREO_PERSONAJ VALUES(C,R);
END IF;
END INGRESAR_CORREO_TEL;


/*----------------------------------------------------CREAR----------------------------------------------------*/
/*----------------------------------------------------CREAR----------------------------------------------------*/
/*----------------------------------------------------CREAR----------------------------------------------------*/
/*----------------------------------------------------CREAR----------------------------------------------------*/
/*----------------------------------------------------CREAR----------------------------------------------------*/


CREATE OR REPLACE FUNCTION CREAR_CLIENTE_NATURAL(D_CN PERSONA_NATURAL.DNI%TYPE,
                                                NOM_CN IN PERSONA_NATURAL.NOMBRES%TYPE DEFAULT '-',
                                                AP_CN IN PERSONA_NATURAL.NOMBRES%TYPE DEFAULT '-',
                                                GEN_CN IN PERSONA_NATURAL.GENERO%TYPE DEFAULT '-',
                                                BD IN DATE DEFAULT '01/01/1970',
                                                TELEF IN NUMBER DEFAULT 0,
                                                DIR IN VARCHAR2 DEFAULT '-',
                                                CORREO IN VARCHAR DEFAULT '-')
RETURN NUMBER
IS 
    AUX NUMBER;
BEGIN
    SELECT COUNT(C.DNI)INTO AUX FROM PERSNAT_CLIENTE C WHERE C.DNI = D_CN;
        IF AUX = 0 THEN
            SELECT COUNT(C.DNI)INTO AUX FROM PERSONA_NATURAL C WHERE C.DNI = D_CN;
            IF AUX = 0 THEN
                INGRESAR_PN (D_CN,NOM_CN,GEN_CN,DIR,BD,AP_CN);
                INGRESAR_CN (D_CN);
                INGRESAR_CORREO_TEL(1,CORREO,TELEF,D_CN);
                RETURN 1;
            ELSE
                INGRESAR_CN (D_CN);
                INGRESAR_CORREO_TEL(1,CORREO,TELEF,D_CN);
                RETURN 2;
            END IF;
        ELSE
            RETURN 3; /*YA EXISTE EL CLIENTE NATURAL*/
        END IF;
END CREAR_CLIENTE_NATURAL;

CREATE OR REPLACE FUNCTION CREAR_CLIENTE_JURIDICO(R_CJ PERSONA_JURIDICA.RUC%TYPE,
                                                RAZ_CJ IN PERSONA_JURIDICA.NOMBRE_EMPRESA%TYPE DEFAULT '-',
                                                TIP_CJ IN PERSONA_JURIDICA.TIPO_EMPRESA%TYPE DEFAULT '-',
                                                PAI_CJ IN PERSONA_JURIDICA.PAIS%TYPE DEFAULT '-',
                                                D_CJ IN PERSONA_JURIDICA.DNI%TYPE DEFAULT 0,
                                                NOM_CJ IN PERSONA_NATURAL.NOMBRES%TYPE DEFAULT '-',
                                                TELEF IN NUMBER DEFAULT 0,
                                                DIR IN VARCHAR2 DEFAULT '-',
                                                CORREO IN VARCHAR DEFAULT '-')
RETURN 
    NUMBER
IS
    AUX NUMBER;
BEGIN
        SELECT COUNT(C.RUC)INTO AUX FROM PERSJUR_CLIENTE C WHERE C.RUC = R_CJ;
        IF AUX = 0 THEN
            SELECT COUNT(C.DNI)INTO AUX FROM PERSONA_NATURAL C WHERE C.DNI = D_CJ;
            IF AUX = 0 THEN
                INGRESAR_PN (D_CJ,NOM_CJ,'','','','');
                SELECT COUNT(C.RUC)INTO AUX FROM PERSONA_JURIDICA C WHERE C.RUC = R_CJ;
                IF AUX = 0 THEN
                    INGRESAR_PJ(R_CJ,RAZ_CJ,TIP_CJ,D_CJ,PAI_CJ,DIR);
                    INGRESAR_CJ(R_CJ);
                    INGRESAR_CORREO_TEL(2,CORREO,TELEF,R => R_CJ);
                    RETURN 4;/*EL REPRESENTANTE SE CREO,LA PJ SE CREO Y SE AGREGO EXITOSAMENTE*/
                ELSE
                    INGRESAR_CJ(R_CJ);
                    INGRESAR_CORREO_TEL(2,CORREO,TELEF,R => R_CJ);
                    RETURN 5;/*EL REPRESENTANTE SE CREO,LA PJ YA EXISTIA Y SE AGREGO EXITOSAMENTE*/
                END IF;
            ELSE
                SELECT COUNT(C.RUC)INTO AUX FROM PERSONA_JURIDICA C WHERE C.RUC = R_CJ;
                IF AUX = 0 THEN
                    INGRESAR_PJ(R_CJ,RAZ_CJ,TIP_CJ,D_CJ,PAI_CJ,DIR);
                    INGRESAR_CJ(R_CJ);
                    INGRESAR_CORREO_TEL(2,CORREO,TELEF,R => R_CJ);
                    RETURN 6;/*EL REPRESENTANTE YA EXISTIA,LA PJ SE CREO Y SE AGREGO EXITOSAMENTE*/
                ELSE
                    INGRESAR_CJ(R_CJ);
                    INGRESAR_CORREO_TEL(2,CORREO,TELEF,R => R_CJ);
                    RETURN 7;/*EL REPRESENTANTE YA EXISTIA,LA PJ YA EXISTIA Y SE AGREGO EXITOSAMENTE*/
                END IF;
            END IF;
        ELSE
            RETURN 8; /*YA EXISTE EL CLIENTE JURIDICO*/
        END IF;
END CREAR_CLIENTE_JURIDICO;
SELECT * FROM correo_personaj;

SELECT * FROM PERSNAT_CLIENTE P,PERSONA_NATURAL PN ,TELEFONO_PERSONA_N T WHERE PN.DNI = P.DNI AND T.DNI = PN.DNI;
SELECT * FROM PERSJUR_CLIENTE P,PERSONA_JURIDICA PJ ,TELEFONO_PERSONA_J T WHERE PJ.RUC = P.RUC AND T.RUC = PJ.RUC;

BEGIN
    DBMS_OUTPUT.PUT_LINE(INGRESAR_CLIENTE(1,12345678,'FRANCO',TELEF=>999999999));
    DBMS_OUTPUT.PUT_LINE(INGRESAR_CLIENTE(2,RAZ_CJ => 'sa',TIP_CJ => 'FRANCO',TELEF=>999999999,DIR => 'CALLE AGS 123', R_CJ => 98765432));
END; 




CREATE SEQUENCE COD_PROV START WITH 1000 INCREMENT BY 1;

CREATE OR REPLACE PROCEDURE INGRESAR_PROVEEDOR(R NUMBER)
IS
    COD NUMBER :=COD_PROV.NEXTVAL;
BEGIN
    INSERT INTO PROVEEDOR VALUES(COD,R);
END INGRESAR_PROVEEDOR;

CREATE OR REPLACE FUNCTION CREAR_PROVEEDOR(R_CJ PERSONA_JURIDICA.RUC%TYPE,
                                            RAZ_CJ PERSONA_JURIDICA.NOMBRE_EMPRESA%TYPE,
                                            TIP_CJ PERSONA_JURIDICA.TIPO_EMPRESA%TYPE,
                                            PAI_CJ IN PERSONA_JURIDICA.PAIS%TYPE DEFAULT '-',
                                            D_CJ IN PERSONA_JURIDICA.DNI%TYPE DEFAULT 0,
                                            NOM_CJ IN PERSONA_NATURAL.NOMBRES%TYPE DEFAULT '-',
                                            TELEF IN NUMBER DEFAULT 0,
                                            DIR IN VARCHAR2 DEFAULT '-',
                                            CORREO IN VARCHAR DEFAULT '-')
RETURN NUMBER
IS
    AUX NUMBER;
BEGIN
    SELECT COUNT(C.RUC)INTO AUX FROM PROVEEDOR C WHERE C.RUC = R_CJ;
    IF AUX = 0 THEN
        SELECT COUNT(C.DNI)INTO AUX FROM PERSONA_NATURAL C WHERE C.DNI = D_CJ;
        IF AUX = 0 THEN
            INGRESAR_PN (D_CJ,NOM_CJ);
            SELECT COUNT(C.RUC)INTO AUX FROM PERSONA_JURIDICA C WHERE C.RUC = R_CJ;
            IF AUX = 0 THEN
                INGRESAR_PJ(R_CJ,RAZ_CJ,TIP_CJ,D_CJ,PAI_CJ,DIR);
                INGRESAR_PROVEEDOR(R_CJ);
                INGRESAR_CORREO_TEL(2,CORREO,TELEF,R => R_CJ);
                RETURN 1;/*EL REPRESENTANTE SE CREO,LA PJ SE CREO Y SE AGREGO EXITOSAMENTE*/
            ELSE
                INGRESAR_PROVEEDOR(R_CJ);
                INGRESAR_CORREO_TEL(2,CORREO,TELEF,R => R_CJ);
                RETURN 2;/*EL REPRESENTANTE SE CREO,LA PJ YA EXISTIA Y SE AGREGO EXITOSAMENTE*/
            END IF;
        ELSE
            SELECT COUNT(C.RUC)INTO AUX FROM PERSONA_JURIDICA C WHERE C.RUC = R_CJ;
            IF AUX = 0 THEN
                INGRESAR_PJ(R_CJ,RAZ_CJ,TIP_CJ,D_CJ,PAI_CJ,DIR);
                INGRESAR_PROVEEDOR(R_CJ);
                INGRESAR_CORREO_TEL(2,CORREO,TELEF,R => R_CJ);
                RETURN 3;/*EL REPRESENTANTE YA EXISTIA,LA PJ SE CREO Y SE AGREGO EXITOSAMENTE*/
            ELSE
                INGRESAR_PROVEEDOR(R_CJ);
                INGRESAR_CORREO_TEL(2,CORREO,TELEF,R => R_CJ);
                RETURN 4;/*EL REPRESENTANTE YA EXISTIA,LA PJ YA EXISTIA Y SE AGREGO EXITOSAMENTE*/
            END IF;
        END IF;
    ELSE
        RETURN 5;/*EL PROVEEDOR YA EXISTE*/
    END IF;
END CREAR_PROVEEDOR;
BEGIN
    DBMS_OUTPUT.PUT_LINE(CREAR_PROVEEDOR(1234567835,'FRANCO','AI'));
END;

CREATE SEQUENCE COD_EMPLEADO START WITH 10000 INCREMENT BY 100;
CREATE OR REPLACE PROCEDURE INGRESAR_TRABAJADOR(D TRABAJADOR.DNI%TYPE,
                                                SALARIO TRABAJADOR.SALARIO%TYPE,
                                                CARGO TRABAJADOR.CARGO%TYPE,
                                                CODS TRABAJADOR.CODIGO_SUPERVISOR%TYPE,
                                                FECHA DATE DEFAULT '01-01-1900')
IS
    COD_E NUMBER := COD_EMPLEADO.NEXTVAL;
    AUX DATE;
BEGIN
    IF FECHA = '01-01-1900' THEN
        SELECT SYSDATE INTO AUX FROM DUAL;
        INSERT INTO TRABAJADOR VALUES(COD_E,D,AUX,SALARIO,CARGO,CODS);
    ELSE
        INSERT INTO TRABAJADOR VALUES(COD_E,D,FECHA,SALARIO,CARGO,CODS);
        END IF;
END INGRESAR_TRABAJADOR;



CREATE OR REPLACE FUNCTION CREAR_EMPLEADO(D PERSONA_NATURAL.DNI%TYPE,
                                          NOM PERSONA_NATURAL.NOMBRES%TYPE,
                                          APE IN PERSONA_NATURAL.NOMBRES%TYPE,
                                          GEN IN PERSONA_NATURAL.GENERO%TYPE,
                                          BD IN DATE,
                                          TELEF IN NUMBER,
                                          DIR IN VARCHAR2,
                                          CORREO IN VARCHAR,
                                          SALARIO TRABAJADOR.SALARIO%TYPE,
                                          CARGO IN VARCHAR2,
                                          CODS IN NUMBER)
RETURN NUMBER
IS
    AUX NUMBER;
BEGIN
    SELECT COUNT(C.DNI)INTO AUX FROM TRABAJADOR C WHERE C.DNI = D;
    IF AUX = 0 THEN
        SELECT COUNT(C.DNI)INTO AUX FROM PERSONA_NATURAL C WHERE C.DNI = D;
        IF AUX = 0 THEN
            INGRESAR_PN (D,NOM,GEN,DIR,BD,APE);
            INGRESAR_TRABAJADOR(D,SALARIO,CARGO,CODS);
            INGRESAR_CORREO_TEL(1,CORREO,TELEF,D);
            RETURN 1;/*EL REPRESENTANTE SE CREO,LA PJ SE CREO Y SE AGREGO EXITOSAMENTE*/
        ELSE
            INGRESAR_TRABAJADOR(D,SALARIO,CARGO,CODS);
            INGRESAR_CORREO_TEL(1,CORREO,TELEF,D);
            RETURN 2;/*EL REPRESENTANTE SE CREO,LA PJ YA EXISTIA Y SE AGREGO EXITOSAMENTE*/
        END IF;
        ELSE
        RETURN 3;/*EL TRABAJADOR YA EXISTE*/
    END IF;
END CREAR_EMPLEADO;


SELECT * FROM TRABAJADOR T, PERSONA_NATURAL PN WHERE T.DNI = PN.DNI;

BEGIN
    DBMS_OUTPUT.PUT_LINE(CREAR_EMPLEADO(12345678,'ROBER', 'ASDA','MACHO', '10-12-1995',123456789, 'QUETEIMPORTAGIL','TUPUTAMADREGEMAIL.COM',15000,'ROBAR',''));
END;


----------------SEQDASDADASDAD---------------------

CREATE SEQUENCE COD_MARCA START WITH 100000 INCREMENT BY 1;

CREATE SEQUENCE COD_CLIENTE START WITH 100 INCREMENT BY 1;

CREATE SEQUENCE COD_PROV START WITH 1000 INCREMENT BY 1;

CREATE SEQUENCE COD_EMPLEADO START WITH 10000 INCREMENT BY 100;

CREATE SEQUENCE COD_PROD START WITH 1000000 INCREMENT BY 1;

CREATE SEQUENCE COD_COMPRO START WITH 1 INCREMENT BY 1;
-------------------ADADASD--------------------------

CREATE OR REPLACE FUNCTION CREAR_PRODUCTO(DES IN VARCHAR2,
                                              CAR IN VARCHAR2,
                                              UD IN VARCHAR2,
                                              PVS PRODUCTO.PRECIOVENTASOL%TYPE,
                                              COD_M PRODUCTO.CODIGO_MARCA%TYPE)
RETURN NUMBER
IS
    COD NUMBER := COD_PROD.NEXTVAL;
BEGIN
    INSERT INTO PRODUCTO VALUES (COD,DES,CAR,UD,PVS,0,0,COD_M);
    RETURN 1;
END CREAR_PRODUCTO;
CREATE OR REPLACE FUNCTION CREAR_MARCA(NOM VARCHAR,
                                           DES IN VARCHAR2)
RETURN NUMBER
IS
    COD NUMBER;
    AUX NUMBER;
BEGIN
    SELECT COUNT(*) INTO AUX FROM MARCA WHERE NOM = MARCA.NOMBRE;
    IF AUX = 0 THEN
    COD := COD_MARCA.NEXTVAL;
    INSERT INTO MARCA VALUES (COD,NOM,DES);
    RETURN 1;/*SE CREO LA MARCA*/
    ELSE
    RETURN 2;/*LA MARCA YA EXISTE*/
    END IF;
END CREAR_MARCA;

CREATE OR REPLACE FUNCTION CREAR_SERVICIO(NOM IN VARCHAR2,
                                          DES IN VARCHAR2,
                                          PRE_V SERVICIO.PRECIO_VENTA%TYPE)
RETURN NUMBER
IS
    COD NUMBER;
    AUX NUMBER :=0;
BEGIN
    SELECT COUNT(*) INTO AUX FROM SERVICIO WHERE NOM = SERVICIO.NOMBRE;
    IF AUX = 0 THEN
    COD := COD_MARCA.NEXTVAL;
    INSERT INTO SERVICIO VALUES (COD,NOM,DES,PRE_V);
    RETURN 1;/*SE CREO EL SERVICIO*/
    ELSE
    RETURN 2;/*EL SERVICIO YA EXISTE*/
    END IF;
END CREAR_SERVICIO;

CREATE OR REPLACE FUNCTION CREAR_PEDIDO_BOLETA(MON PEDIDO.MONTO%TYPE,
                                        COD_T IN NUMBER,
                                        EST IN VARCHAR2,
                                        NOM IN VARCHAR2,
                                        D IN NUMBER)
RETURN NUMBER
IS 
    COD NUMBER := COD_COMPRO.NEXTVAL;
    COD_C NUMBER;
    AUX NUMBER;
    FEC DATE;
BEGIN
    SELECT SYSDATE INTO FEC FROM DUAL;
    SELECT COUNT(*) INTO AUX FROM PERSNAT_CLIENTE WHERE DNI = D;
    IF AUX = 0 THEN
        AUX := CREAR_CLIENTE_NATURAL(D,NOM);
        SELECT COD INTO COD_C FROM PERSNAT_CLIENTE WHERE DNI = D;
        INSERT INTO PEDIDO VALUES (COD,'BOLETA',MON,FEC,EST,COD_T,COD_C);
        RETURN 1;
    ELSE
        SELECT COD INTO COD_C FROM PERSNAT_CLIENTE WHERE DNI = D;
        INSERT INTO PEDIDO VALUES (COD,'BOLETA',MON,FEC,EST,COD_T,COD_C);
        RETURN 2;
    END IF;
END CREAR_PEDIDO_BOLETA;

CREATE OR REPLACE FUNCTION CREAR_PEDIDO_FACTURA(MON PEDIDO.MONTO%TYPE,
                                        RAZ IN VARCHAR2,
                                        TIPO IN VARCHAR2,
                                        DIRE IN VARCHAR2,
                                        COD_T IN NUMBER,
                                        EST IN VARCHAR2,
                                        R IN NUMBER)
RETURN NUMBER
IS 
    COD NUMBER := COD_COMPRO.NEXTVAL;
    COD_C NUMBER;
    AUX NUMBER;
    FEC DATE;
BEGIN
    SELECT SYSDATE INTO FEC FROM DUAL;
    SELECT COUNT(*) INTO AUX FROM PERSJUR_CLIENTE WHERE RUC = R;
    IF AUX = 0 THEN
        AUX := CREAR_CLIENTE_JURIDICO(R,RAZ,TIPO,DIR=>DIRE);
        SELECT COD INTO COD_C FROM PERSJUR_CLIENTE WHERE RUC = R;
        INSERT INTO PEDIDO VALUES (COD,'FACTURA',MON,FEC,EST,COD_T,COD_C);
        RETURN 1;/*SE CREO AL CLIENTE*/
    ELSE
        SELECT COD INTO COD_C FROM PERSJUR_CLIENTE WHERE RUC = R;
        INSERT INTO PEDIDO VALUES (COD,'FACTURA',MON,FEC,EST,COD_T,COD_C);
        RETURN 2;/*EL CLIENTE YA EXISTIA*/
    END IF;
    
END CREAR_PEDIDO_FACTURA;


/*----------------------------------------------------RETORNO NUMERICO----------------------------------------------------*/
/*----------------------------------------------------RETORNO NUMERICO----------------------------------------------------*/
/*----------------------------------------------------RETORNO NUMERICO----------------------------------------------------*/
/*----------------------------------------------------RETORNO NUMERICO----------------------------------------------------*/
/*----------------------------------------------------RETORNO NUMERICO----------------------------------------------------*/

CREATE OR REPLACE FUNCTION OBTENER_COSTO_PROM(COD_PROD PRODUCTO.CODIGO_PRODUCTO%TYPE)
RETURN NUMBER
IS
    ANS NUMBER;
BEGIN
    SELECT P.PROMEDIO_PONDERADO INTO ANS
    FROM
    (SELECT 
        P.CODIGO_PRODUCTO,
        ROUND(SUM(PROM.COSTO_T)/SUM(V.CANTIDAD),2) AS PROMEDIO_PONDERADO 
    FROM 
        VENDE V, 
        PRODUCTO P,
        (SELECT 
            P.CODIGO_PRODUCTO,
            P.DESCRIPCION,
            V.CANTIDAD*V.COSTODOLAR AS COSTO_T 
        FROM 
            VENDE V, 
            PRODUCTO P 
        WHERE V.CODIGO_PRODUCTO = P.CODIGO_PRODUCTO) PROM
    WHERE V.CODIGO_PRODUCTO = P.CODIGO_PRODUCTO 
        AND V.CODIGO_PRODUCTO = PROM.CODIGO_PRODUCTO
    GROUP BY P.CODIGO_PRODUCTO) P
    WHERE P.CODIGO_PRODUCTO = COD_PROD;
    RETURN ANS;
END OBTENER_COSTO_PROM;

CREATE OR REPLACE FUNCTION OBTENER_INVENTARIO_ACTUAL(COD_PROD PRODUCTO.CODIGO_PRODUCTO%TYPE)
RETURN NUMBER
IS
    ANS NUMBER;
    AUX_POS NUMBER:=0;
    AUX_NEG NUMBER:=0;
BEGIN
    SELECT SUM(CANTIDAD) INTO AUX_NEG FROM CONTIENE_PRODUCTO CP, PRODUCTO P WHERE CP.CODIGO_PRODUCTO = P.CODIGO_PRODUCTO;
    SELECT SUM(CANTIDAD) INTO AUX_POS FROM VENDE V, PRODUCTO P WHERE V.CODIGO_PRODUCTO = P.CODIGO_PRODUCTO AND V.CODIGO_PRODUCTO = COD_PROD;
    ANS := AUX_POS - AUX_NEG;
    RETURN ANS;
END OBTENER_INVENTARIO_ACTUAL;

--PRUEBAS
/*----------------------------------------------------PRUEBAS----------------------------------------------------*/
/*----------------------------------------------------PRUEBAS----------------------------------------------------*/
/*----------------------------------------------------PRUEBAS----------------------------------------------------*/
/*----------------------------------------------------PRUEBAS----------------------------------------------------*/
/*----------------------------------------------------PRUEBAS----------------------------------------------------*/
BEGIN
    DBMS_OUTPUT.PUT_LINE(CREAR_PEDIDO_BOLETA(1000,12345678,'DFDF','ASDASD',87654321));
    DBMS_OUTPUT.PUT_LINE('XDEDEDD ' || DEVOLVER_INVENTARIOS(2));
END;

SELECT * FROM TRABAJADOR T, PERSONA_NATURAL PN WHERE T.DNI = PN.DNI;
SELECT * FROM CLIENTE C, PERSONA_NATURAL PN, PERSNAT_CLIENTE PC WHERE PC.DNI = PN.DNI AND C.COD = PC.COD;

BEGIN
    DBMS_OUTPUT.PUT_LINE(CREAR_CLIENTE_NATURAL(87654321,'FRANCO','MARQUZ','NOB','01/01/1970',999666333,'XDE'));
    DBMS_OUTPUT.PUT_LINE(CREAR_EMPLEADO(12345678,'ROBER', 'ASDA','MACHO', '10-12-1995',123456789, 'QUETEIMPORTAGIL','TUPUTAMADREGEMAIL.COM',15000,'ROBAR',''));
END;

/*----------------------------------------------------MODIFICACIONES----------------------------------------------------*/
/*----------------------------------------------------MODIFICACIONES----------------------------------------------------*/
/*----------------------------------------------------MODIFICACIONES----------------------------------------------------*/
/*----------------------------------------------------MODIFICACIONES----------------------------------------------------*/
/*----------------------------------------------------MODIFICACIONES----------------------------------------------------*/

CREATE OR REPLACE FUNCTION ACT_PER_NAT(
DNI_DATO            PERSONA_NATURAL.DNI%TYPE                                    ,
NOMBRES_DATO    IN  PERSONA_NATURAL.NOMBRES%TYPE            DEFAULT '-'         ,
APELLIDOS_DATO  IN  PERSONA_NATURAL.NOMBRES%TYPE            DEFAULT '-'         ,
GENERO_DATO     IN  PERSONA_NATURAL.GENERO%TYPE             DEFAULT '-'         ,
BD_DATO         IN  PERSONA_NATURAL.FECHA_NACIMIENTO%TYPE  DEFAULT '01/01/1970',
TELEF_DATO      IN  TELEFONO_PERSONA_N.TELEFONO%TYPE        DEFAULT 0           ,
DIR_DATO        IN  PERSONA_NATURAL.DIRECCION%TYPE          DEFAULT '-',
CORREO_DATO     IN  CORREO_PERSONAN.CORREO%TYPE             DEFAULT '-')
RETURN
    NUMBER
IS
    CONT NUMBER;
BEGIN
    SELECT COUNT(*) INTO CONT FROM PERSONA_NATURAL WHERE DNI = DNI_DATO;
    IF(CONT=0)THEN
        RETURN 2;       /*NO EXISTE LA PERSONA NATURAL*/
    END IF;
    IF(NOMBRES_DATO!='-')THEN
        UPDATE PERSONA_NATURAL SET NOMBRES = NOMBRES_DATO WHERE DNI=DNI_DATO;
    END IF;
    IF(APELLIDOS_DATO!='-')THEN
        UPDATE PERSONA_NATURAL SET APELLIDOS = APELLIDOS_DATO WHERE DNI=DNI_DATO;
    END IF;
    IF(GENERO_DATO!='-')THEN
        UPDATE PERSONA_NATURAL SET GENERO = GENERO_DATO WHERE DNI=DNI_DATO;
    END IF;
    IF(BD_DATO!='01/01/1970')THEN
        UPDATE PERSONA_NATURAL SET FECHA_NACIMIENTO=BD_DATO WHERE DNI=DNI_DATO;
    END IF;
    IF(DIR_DATO!='-')THEN
        UPDATE PERSONA_NATURAL SET DIRECCION = DIR_DATO WHERE DNI=DNI_DATO;
    END IF;
    IF(CORREO_DATO!='-')THEN
        DELETE FROM CORREO_PERSONAN WHERE DNI = DNI_DATO;
        INSERT INTO CORREO_PERSONAN VALUES(CORREO_DATO,DNI_DATO);
    END IF;
    IF(TELEF_DATO!=0)THEN
        DELETE FROM TELEFONO_PERSONA_N WHERE DNI=DNI_DATO;
        INSERT INTO TELEFONO_PERSONA_N VALUES(TELEF_DATO,DNI_DATO);
    END IF;
    RETURN 1;           /*TODO FUE INGRESADO CORRECTAMENTE*/
END;

CREATE OR REPLACE FUNCTION ACT_PER_JUR(
RUC_DATO            PERSONA_JURIDICA.RUC%TYPE                                   ,
PAIS_DATO       IN  PERSONA_JURIDICA.PAIS%TYPE              DEFAULT '-'         ,
DIRECCION_DATO  IN  PERSONA_JURIDICA.DIRECCION%TYPE         DEFAULT '-'         ,
TIPO_DATO       IN  PERSONA_JURIDICA.TIPO_EMPRESA%TYPE      DEFAULT '-'         ,
NOMBRE_DATO     IN  PERSONA_JURIDICA.NOMBRE_EMPRESA%TYPE    DEFAULT '-'         ,
TELEF_DATO      IN  TELEFONO_PERSONA_J.TELEFONO%TYPE        DEFAULT 0           ,
DNI_DATO        IN  PERSONA_JURIDICA.DNI%TYPE               DEFAULT 90909090    ,
CORREO_DATO     IN  CORREO_PERSONAJ.CORREO%TYPE             DEFAULT '-'         )
RETURN
    NUMBER
IS
    CONT NUMBER;
    CONTDNI NUMBER;
    CONTEXTRA NUMBER :=0;
BEGIN
    SELECT COUNT(*) INTO CONT FROM PERSONA_JURIDICA WHERE RUC = RUC_DATO;
    IF(CONT=0)THEN
        RETURN 2;           /*NO EXISTE LA PERSONA JURIDICA*/
    END IF;
    
    IF(PAIS_DATO!='-')THEN
        UPDATE PERSONA_JURIDICA SET PAIS = PAIS_DATO WHERE RUC=RUC_DATO;
        CONTEXTRA:=1;
    END IF;
    IF(DIRECCION_DATO!='-')THEN
        UPDATE PERSONA_JURIDICA SET DIRECCION = DIRECCION_DATO WHERE RUC=RUC_DATO;
        CONTEXTRA:=1;
    END IF;
    IF(TIPO_DATO!='-')THEN
        UPDATE PERSONA_JURIDICA SET TIPO_EMPRESA = TIPO_DATO WHERE RUC=RUC_DATO;
        CONTEXTRA:=1;
    END IF;
    IF(NOMBRE_DATO!='-')THEN
        UPDATE PERSONA_JURIDICA SET NOMBRE_EMPRESA=NOMBRE_DATO WHERE RUC=RUC_DATO;
        CONTEXTRA:=1;
    END IF;
    
    IF(CORREO_DATO!='-')THEN
        DELETE FROM CORREO_PERSONAJ WHERE RUC = RUC_DATO;
        INSERT INTO CORREO_PERSONAJ VALUES(CORREO_DATO,RUC_DATO);
        CONTEXTRA:=1;
    END IF;
    IF(TELEF_DATO!=0)THEN
        DELETE FROM TELEFONO_PERSONA_J WHERE RUC = RUC_DATO;
        INSERT INTO TELEFONO_PERSONA_J VALUES(TELEF_DATO,RUC_DATO);
        CONTEXTRA:=1;
    END IF;
    IF(DNI_DATO!=90909090)THEN
        SELECT COUNT(*) INTO CONTDNI FROM PERSONA_NATURAL WHERE DNI=DNI_DATO;
        IF(CONTDNI=0)THEN
            IF(CONTEXTRA=1)THEN
                RETURN 4;               /*SE ACTUALIZARON TODOS LOS DATOS PERO EL DNI NO EXISTE*/
            END IF;
            RETURN 5;                   /*NO EXISTE EL DNI INGRESO*/
        END IF;
        UPDATE PERSONA_JURIDICA SET DNI=DNI_DATO WHERE RUC = RUC_DATO;
        RETURN 6;       /*SE ACTUALIZARON TODOS LOS DATOS CORRECTAMENTE*/
    END IF;
    IF(CONTEXTRA=1)THEN
        RETURN 3;       /*SE ACTUALIZARON TODOS LOS DATOS CORRECTAMENTE*/
    END IF;
    RETURN 1;           /*NO SE ACTUALIZÓ NINGÚN DATO*/
END;

CREATE OR REPLACE FUNCTION ACT_TRA_DNI(
DNI_DATO            TRABAJADOR.DNI%TYPE                                         ,
SALARIO_DATO    IN  TRABAJADOR.SALARIO%TYPE                     DEFAULT 0       ,  
DNI_SUP_DATO    IN  TRABAJADOR.CODIGO_SUPERVISOR%TYPE           DEFAULT 90909090)
RETURN NUMBER
IS
    CONT NUMBER;
    CONTEXIS NUMBER;
    CONTCAM NUMBER:=0;
BEGIN
    SELECT COUNT(*) INTO CONT FROM TRABAJADOR WHERE DNI=DNI_DATO;
    IF(CONT=0)THEN
        RETURN 1;           /*NO EXISTE EL TRABAJADOR*/
    END IF;
    IF(SALARIO_DATO!=0)THEN
        UPDATE TRABAJADOR SET SALARIO = SALARIO_DATO WHERE DNI=DNI_DATO;
        CONTCAM:=1;
    END IF;
    IF(DNI_SUP_DATO!=90909090)THEN
        SELECT COUNT(*) INTO CONTEXIS FROM TRABAJADOR WHERE DNI=DNI_SUP_DATO;
        IF(CONTEXIS=0)THEN
            IF(CONTCAM=1)THEN
                RETURN 4;       /*SE HICIERON LOS CAMBIOS PERO NO EXISTE EL JEFE*/
            END IF;
            RETURN 3;           /*NO EXISTE EL JEFE*/
        END IF;
        UPDATE TRABAJADOR SET CODIGO_SUPERVISOR=DNI_SUP_DATO WHERE DNI=DNI_DATO;
        RETURN 2;               /*SE APLICARON LOS CAMBIOS*/
    END IF;
    IF(CONTCAM=1)THEN
        RETURN 5;           /*SE APLICARON TODOS LOS CAMBIOS*/
    END IF;
    RETURN 6;               /*NO SE ACTUALIZO NADA*/
END;

CREATE OR REPLACE FUNCTION ACT_PRO_COD(
CODIGO_DATO         PRODUCTO.CODIGO_PRODUCTO%TYPE,
DESCRIP_DATO    IN  PRODUCTO.DESCRIPCION%TYPE       DEFAULT '-' ,
CARAC_DATO      IN  PRODUCTO.CARACT%TYPE            DEFAULT '-' ,
UNID_DATO       IN  PRODUCTO.UNID_MEDIDA%TYPE       DEFAULT '-' ,
PRECIO_DATO     IN  PRODUCTO.PRECIOVENTASOL%TYPE    DEFAULT 0   ,
MARCA_DATO      IN  PRODUCTO.CODIGO_MARCA%TYPE      DEFAULT '-' )
RETURN
    NUMBER
IS
    CONT NUMBER;
    CONTEXTR NUMBER:=0;
    CONTMARCA NUMBER;
BEGIN
    SELECT COUNT(*) INTO CONT FROM PRODUCTO WHERE CODIGO_PRODUCTO = CODIGO_DATO;
    IF(CONT=0)THEN
        RETURN 1;       /*NO EXISTE EL PRODUCTO*/
    END IF;
    
    IF(DESCRIP_DATO!='-')THEN
        UPDATE PRODUCTO SET DESCRIPCION=DESCRIP_DATO WHERE CODIGO_PRODUCTO=CODIGO_DATO;
        CONTEXTR:=1;
    END IF;
    IF(CARAC_DATO!='-')THEN
        UPDATE PRODUCTO SET CARACT=CARAC_DATO WHERE CODIGO_PRODUCTO=CODIGO_DATO;
        CONTEXTR:=1;
    END IF;
    IF(UNID_DATO!='-')THEN
        UPDATE PRODUCTO SET UNID_MEDIDA=UNID_DATO WHERE CODIGO_PRODUCTO=CODIGO_DATO;
        CONTEXTR:=1;
    END IF;
    IF(PRECIO_DATO!=0)THEN
        UPDATE PRODUCTO SET PRECIOVENTASOL=PRECIO_DATO WHERE CODIGO_PRODUCTO=CODIGO_DATO;
        CONTEXTR:=1;
    END IF;
    
    IF(MARCA_DATO!='-')THEN
        SELECT COUNT(*) INTO CONTMARCA FROM MARCA WHERE CODIGO_MARCA=MARCA_DATO;
        IF(CONTMARCA=1)THEN
            UPDATE PRODUCTO SET CODIGO_MARCA=MARCA_DATO WHERE CODIGO_PRODUCTO=CODIGO_DATO;
            RETURN 3;
        END IF;
        IF(CONTEXTR=1)THEN
            RETURN 5;       /*SE ACTUALIZÓ PERO NO EXISTE LA MARCA*/
        END IF;
        RETURN 6;           /*NO EXISTE LA MARCA*/
    END IF;
    
    IF(CONTEXTR=1)THEN
        RETURN 3;           /*SE ACTUALIZO TODO*/
    END IF;
    RETURN 2;           /*NO SE ACTUALIZO NADA*/
END;

CREATE OR REPLACE FUNCTION ACT_SER_COD(
CODIGO_DATO         SERVICIO.CODIGO_SERVICIO%TYPE,
NOMBRE_DATO     IN  SERVICIO.NOMBRE%TYPE            DEFAULT '-',
DESCR_DATO      IN  SERVICIO.DESCRIPCION%TYPE       DEFAULT '-',
PRECIO_DATO     IN  SERVICIO.PRECIO_VENTA%TYPE      DEFAULT 0   )
RETURN NUMBER
IS
    CONT NUMBER;
BEGIN
    SELECT COUNT(*) INTO CONT FROM SERVICIO WHERE CODIGO_SERVICIO=CODIGO_DATO;
    IF(CONT=0)THEN
        RETURN 1;   /*NO EXISTE EL SERVICIO*/
    END IF;
    
    IF(NOMBRE_DATO!='-')THEN
        UPDATE SERVICIO SET NOMBRE=NOMBRE_DATO WHERE CODIGO_SERVICIO=CODIGO_DATO;
    END IF;
    IF(DESCR_DATO!='-')THEN
        UPDATE SERVICIO SET DESCRIPCION=DESCR_DATO WHERE CODIGO_SERVICIO=CODIGO_DATO;
    END IF;
    IF(PRECIO_DATO!=0)THEN
        UPDATE SERVICIO SET PRECIO_VENTA=PRECIO_DATO WHERE CODIGO_SERVICIO=CODIGO_DATO;
    END IF;
    RETURN 2;       /*SE APLICARON LOS CAMBIOS*/
END;

/*----------------------------------------------------INGRESO----------------------------------------------------*/
/*----------------------------------------------------INGRESO----------------------------------------------------*/
/*----------------------------------------------------INGRESO----------------------------------------------------*/
/*----------------------------------------------------INGRESO----------------------------------------------------*/
/*----------------------------------------------------INGRESO----------------------------------------------------*/


/*----------------------------------------------------PROCEDURE----------------------------------------------------*/

CREATE OR REPLACE PROCEDURE ACTUALIZAR_CANTIDAD_ORIGEN(COD_PROD PRODUCTO.CODIGO_PRODUCTO%TYPE)
IS
    XD NUMBER;
BEGIN
    XD :=OBTENER_INVENTARIO_ACTUAL(COD_PROD);
    UPDATE 
        PRODUCTO 
    SET
        CANT_DISPO  = XD
    WHERE
        CODIGO_PRODUCTO = COD_PROD;
END ACTUALIZAR_CANTIDAD_ORIGEN;

CREATE OR REPLACE PROCEDURE ACTUALIZAR_COSTO_TOTAL_ORIGEN(COD_PROD PRODUCTO.CODIGO_PRODUCTO%TYPE)
IS
    XD NUMBER;
BEGIN
    XD :=OBTENER_COSTO_TOTAL_DOL(COD_PROD);
    UPDATE 
        PRODUCTO 
    SET
        CST_TOT_DOLAR  = XD
    WHERE
        CODIGO_PRODUCTO = COD_PROD;
END ACTUALIZAR_COSTO_TOTAL_ORIGEN;

CREATE OR REPLACE PROCEDURE ACT_COSTOT_CANT(COD_PROD PRODUCTO.CODIGO_PRODUCTO%TYPE,
                                                    C NUMBER,
                                                    CST PRODUCTO.CST_TOT_DOLAR%TYPE)
IS
    AUXCANTACTUAL NUMBER;
    AUXCOSTTOTACT NUMBER;
    AUX NUMBER;
BEGIN
    SELECT CST_TOT_DOLAR INTO AUXCOSTTOTACT FROM PRODUCTO WHERE COD_PROD = CODIGO_PRODUCTO;
    SELECT CANT_DISPO INTO AUXCANTACTUAL FROM PRODUCTO WHERE COD_PROD = CODIGO_PRODUCTO;
    SELECT ROUND(AUXCOSTTOTACT - (CST*C),2) INTO AUX FROM DUAL;
    UPDATE PRODUCTO SET CST_TOT_DOLAR = AUX WHERE COD_PROD = CODIGO_PRODUCTO;
    AUX := AUXCANTACTUAL - C;
    UPDATE PRODUCTO SET CANT_DISPO = AUX WHERE COD_PROD = CODIGO_PRODUCTO;
END ACT_COSTOT_CANT;

CREATE OR REPLACE PROCEDURE ACT_COSTOT_CANT_PROV(COD_PROD PRODUCTO.CODIGO_PRODUCTO%TYPE,
                                                    C NUMBER,
                                                    CST PRODUCTO.CST_TOT_DOLAR%TYPE)
IS
    AUXCANTACTUAL NUMBER;
    AUXCOSTTOTACT NUMBER;
    AUX NUMBER;
BEGIN
    SELECT CST_TOT_DOLAR INTO AUXCOSTTOTACT FROM PRODUCTO WHERE COD_PROD = CODIGO_PRODUCTO;
    SELECT CANT_DISPO INTO AUXCANTACTUAL FROM PRODUCTO WHERE COD_PROD = CODIGO_PRODUCTO;
    SELECT ROUND(AUXCOSTTOTACT + (CST*C),2) INTO AUX FROM DUAL;
    UPDATE PRODUCTO SET CST_TOT_DOLAR = AUX WHERE COD_PROD = CODIGO_PRODUCTO;
    AUX := AUXCANTACTUAL + C;
    UPDATE PRODUCTO SET CANT_DISPO = AUX WHERE COD_PROD = CODIGO_PRODUCTO;
END ACT_COSTOT_CANT_PROV;

CREATE OR REPLACE PROCEDURE ACTUALIZAR_EST_MON(COMPRO PEDIDO.NRO_COMPROBANTE%TYPE)
IS
    AUX NUMBER;
BEGIN
    AUX:=CALCULAR_MONTO(COMPRO);
    UPDATE PEDIDO SET MONTO = AUX, ESTADO = 'PAGADO' WHERE NRO_COMPROBANTE = COMPRO;
END;
CREATE OR REPLACE FUNCTION LLAMAR_AUX(COD PEDIDO.NRO_COMPROBANTE%TYPE)
RETURN NUMBER
IS
BEGIN
    ACTUALIZAR_EST_MON(COD);
    RETURN 1;
END;

CREATE OR REPLACE PROCEDURE ELIM_TUPLAS_CONT_PROD(COMPRO PEDIDO.NRO_COMPROBANTE%TYPE)
IS
    AUX NUMBER;
    CANT NUMBER;
    CODP NUMBER;
BEGIN
    SELECT COUNT(*) INTO AUX
    FROM CONTIENE_PRODUCTO C, PEDIDO P 
    WHERE P.NRO_COMPROBANTE = C.NRO_COMPROBANTE  
        AND P.ESTADO != 'PAGADO' AND C.NRO_COMPROBANTE = COMPRO;
    IF AUX > 0 THEN
        FOR I IN 1..AUX
        LOOP
            SELECT CANTIDAD*-1 INTO CANT FROM  CONTIENE_PRODUCTO WHERE NRO_COMPROBANTE = COMPRO AND ROWNUM = 1;
            SELECT CODIGO_PRODUCTO INTO CODP FROM  CONTIENE_PRODUCTO WHERE NRO_COMPROBANTE = COMPRO AND ROWNUM = 1;
            DBMS_OUTPUT.PUT_LINE(INGRESAR_CONTIENE_PRODUCTO(COMPRO,CODP,CANT));
            DELETE FROM CONTIENE_PRODUCTO WHERE NRO_COMPROBANTE = COMPRO AND CODIGO_PRODUCTO = CODP;
        END LOOP;
    ELSE
        DBMS_OUTPUT.PUT_LINE('NO EXISTEN TUPLAS EN LA TABLA CONTIENE_PRODUCTO');
    END IF;
END ELIM_TUPLAS_CONT_PROD;

CREATE OR REPLACE PROCEDURE ELIM_TUPLAS_CONT_SER(COMPRO PEDIDO.NRO_COMPROBANTE%TYPE)
IS
    AUX NUMBER;
    CANT NUMBER;
    CODS NUMBER;
BEGIN
    SELECT COUNT(*) INTO AUX
    FROM CONTIENE_SERVICIO C, PEDIDO P 
    WHERE P.NRO_COMPROBANTE = C.NRO_COMPROBANTE  
        AND P.ESTADO != 'PAGADO' AND C.NRO_COMPROBANTE = COMPRO;
    IF AUX > 0 THEN
        DELETE FROM CONTIENE_SERVICIO WHERE NRO_COMPROBANTE = COMPRO;
    ELSE
        DBMS_OUTPUT.PUT_LINE('NO EXISTEN TUPLAS EN CONTIENE_SERVICIO');
    END IF;
END ELIM_TUPLAS_CONT_SER;

/*---------------------------------------------------- FIN PROCEDURE----------------------------------------------------*/


CREATE OR REPLACE FUNCTION INGRESAR_CONTIENE_PRODUCTO (COMPRO CONTIENE_PRODUCTO.NRO_COMPROBANTE%TYPE,
                                                        COD_P CONTIENE_PRODUCTO.CODIGO_PRODUCTO%TYPE,
                                                        CANT CONTIENE_PRODUCTO.CANTIDAD%TYPE)
RETURN NUMBER
IS 
    AUX NUMBER;
    AUX2 NUMBER;
    COSTO_UNIT NUMBER;
    PRECIO_UNIT NUMBER;
BEGIN  
    SELECT COUNT(*) INTO AUX FROM PEDIDO WHERE NRO_COMPROBANTE = COMPRO;
    IF AUX = 1 THEN
        SELECT COUNT(*) INTO AUX FROM PRODUCTO WHERE COD_P = CODIGO_PRODUCTO;
        IF AUX = 1 THEN
            SELECT COUNT(*) INTO AUX FROM CONTIENE_PRODUCTO WHERE CODIGO_PRODUCTO = COD_P AND NRO_COMPROBANTE = COMPRO;
            IF AUX = 0 THEN
                SELECT CANT_DISPO INTO AUX FROM PRODUCTO WHERE CODIGO_PRODUCTO = COD_P;
                IF AUX >= CANT THEN
                    SELECT ROUND(CST_TOT_DOLAR/CANT_DISPO,2) INTO COSTO_UNIT FROM PRODUCTO WHERE CODIGO_PRODUCTO = COD_P;
                    SELECT PRECIOVENTASOL INTO PRECIO_UNIT FROM PRODUCTO WHERE CODIGO_PRODUCTO = COD_P;
                    INSERT INTO CONTIENE_PRODUCTO VALUES (COMPRO,COD_P,CANT,COSTO_UNIT,PRECIO_UNIT);
                    ACT_COSTOT_CANT(COD_P,CANT,COSTO_UNIT);
                    RETURN 1;/*SE AGREGO LA CANTIDAD DE PRODUCTO AL PEDIDO CON COMPROBANTE DEL CODIGO INTRODUCIDO*/
                 ELSE
                    RETURN 2;/*NO SE PUEDE AGREGAR EL PEDIDO, VALOR MAYOR A EXISTENCIAS*/
                END IF;
            ELSE
                SELECT CANT_DISPO INTO AUX FROM PRODUCTO WHERE CODIGO_PRODUCTO = COD_P;
                SELECT CST_CMPR_DLR_UNIT INTO COSTO_UNIT FROM CONTIENE_PRODUCTO WHERE CODIGO_PRODUCTO = COD_P AND NRO_COMPROBANTE = COMPRO;
                SELECT ROUND(CST_TOT_DOLAR/CANT_DISPO,2) INTO COSTO_UNIT FROM PRODUCTO WHERE CODIGO_PRODUCTO = COD_P;
                SELECT PRECIOVENTASOL INTO PRECIO_UNIT FROM PRODUCTO WHERE CODIGO_PRODUCTO = COD_P;
                IF AUX >= CANT THEN
                    SELECT CANTIDAD INTO AUX FROM CONTIENE_PRODUCTO WHERE CODIGO_PRODUCTO = COD_P AND NRO_COMPROBANTE = COMPRO;
                    AUX2 := AUX + CANT;
                    UPDATE CONTIENE_PRODUCTO SET CANTIDAD = AUX2 WHERE CODIGO_PRODUCTO = COD_P AND NRO_COMPROBANTE = COMPRO;
                    ACT_COSTOT_CANT(COD_P,CANT,COSTO_UNIT);
                    RETURN 3;/*SE AGREGO CANTIDAD INTRODUCIDA A LA CANTIDAD EXISTENTE EN UN PEDIDO PREVIO*/
                ELSE
                    RETURN 4;/*NO SE PUEDE AGREGAR EL PEDIDO, VALOR MAYOR A EXISTENCIAS*/
                END IF;
            END IF;
        ELSE
            RETURN 5;/*NO EXISTE EL PRODUCTO INGRESADO PERO SI EL COMPROBANTE*/
        END IF;
    ELSE
        RETURN 6;/*NO EXISTE EL COMPROBANTE INGRESADO*/
    END IF;
END;

CREATE OR REPLACE FUNCTION CANCELAR_VENTA(COMPRO PEDIDO.NRO_COMPROBANTE%TYPE)
RETURN NUMBER
IS
    AUX NUMBER;
BEGIN
    SELECT COUNT(*) INTO AUX FROM PEDIDO WHERE NRO_COMPROBANTE = COMPRO;
    IF AUX >0 THEN
        ELIM_TUPLAS_CONT_PROD(COMPRO);
        ELIM_TUPLAS_CONT_SER(COMPRO);
        DELETE FROM PEDIDO WHERE NRO_COMPROBANTE=COMPRO;
        RETURN 1;/*SE BORRARON LAS TUPLAS Y EL COMPROBANTE*/
    ELSE
        RETURN 2;/*NO EXISTE EL COMPROBANTE*/
    END IF;
END;

CREATE OR REPLACE FUNCTION INGRESAR_VENDE(COD_P     PRODUCTO.CODIGO_PRODUCTO%TYPE,                 
                                          R         PERSONA_JURIDICA.RUC%TYPE,
                                          RAZ       PERSONA_JURIDICA.NOMBRE_EMPRESA%TYPE,
                                          TPO       PERSONA_JURIDICA.TIPO_EMPRESA%TYPE,
                                          D         PERSONA_NATURAL.DNI%TYPE,
                                          COMPRO    VENDE.COMPROBANTE%TYPE,  
                                          CAN       VENDE.CANTIDAD%TYPE,
                                          CSTDO     PRODUCTO.CST_TOT_DOLAR%TYPE,
                                          FECHA     DATE,
                                          NOM       VARCHAR2 DEFAULT '-')
RETURN NUMBER
IS
    AUX NUMBER;
    COD NUMBER;
BEGIN
    
    SELECT COUNT(*) INTO AUX FROM PROVEEDOR WHERE RUC = R;
    IF AUX = 0 THEN
        DBMS_OUTPUT.PUT_LINE(CREAR_PROVEEDOR(R_CJ=>R,RAZ_CJ=>RAZ,TIP_CJ=>TPO,D_CJ=>D,NOM_CJ=>NOM));
    END IF;
    COD := OBTENER_COD_PROV(R);
    SELECT COUNT(*) INTO AUX FROM VENDE WHERE COD_P =CODIGO_PRODUCTO AND COD = CODIGO_PROVEEDOR AND COMPRO = COMPROBANTE;
    IF AUX = 0 THEN
        SELECT COUNT(*) INTO AUX FROM PRODUCTO WHERE COD_P =CODIGO_PRODUCTO;
        IF AUX > 0 THEN
            INSERT INTO VENDE VALUES(COD_P,COMPRO,COD,CSTDO,FECHA,CAN);
            ACT_COSTOT_CANT_PROV(COD_P,CAN,CSTDO);
            RETURN 1;/*SE INGRESO LA TUPLA*/
        ELSE
            RETURN 2;/*NO SE ENCONTRO EL PRODUCTO INGRESADO*/
        END IF;
    ELSE
        ACT_COSTOT_CANT_PROV(COD_P,CAN,CSTDO);
        RETURN 3;/*LA TUPLA YA EXISTIA Y SOLO SE LE AUMENTO LOS VALORES*/
    END IF;
END INGRESAR_VENDE;

CREATE OR REPLACE FUNCTION INGRESAR_CONTIENE_SERVICIO (COMPRO PEDIDO.NRO_COMPROBANTE%TYPE,
                                                        CODS SERVICIO.CODIGO_SERVICIO%TYPE,
                                                        CANT NUMBER)
RETURN NUMBER
IS
    AUX NUMBER;
    AUX2 NUMBER;
BEGIN
    SELECT COUNT(*) INTO AUX FROM SERVICIO WHERE CODIGO_SERVICIO =CODS;
    DBMS_OUTPUT.PUT_LINE(AUX);
    SELECT COUNT(*) INTO AUX2 FROM PEDIDO WHERE NRO_COMPROBANTE = COMPRO;
    IF AUX = 1 AND AUX2 = 1 THEN
        SELECT COUNT(*) INTO AUX FROM CONTIENE_SERVICIO WHERE COMPRO = NRO_COMPROBANTE AND CODS = CODIGO_SERVICIO;
        IF AUX = 0 THEN
            INSERT INTO CONTIENE_SERVICIO VALUES(COMPRO,CODS,CANT);
            RETURN 1;/*SE INSERTO LA NUEVA TUPLA*/
        ELSE
            SELECT CANTIDAD INTO AUX FROM CONTIENE_SERVICIO WHERE COMPRO = NRO_COMPROBANTE AND CODS = CODIGO_SERVICIO;
            AUX2 := CANT + AUX;
            UPDATE CONTIENE_SERVICIO SET CANTIDAD = AUX2 WHERE COMPRO = NRO_COMPROBANTE AND CODS = CODIGO_SERVICIO;
            RETURN 2;/*SE AUMENTO LA CANTIDAD A LA TUPLA EXISTENTE*/
        END IF;
    ELSE
        RETURN 3;/*NO EXISTE O EL CODIGO DE SERVICIO O EL COMPROBANTE*/
    END IF;
END INGRESAR_CONTIENE_SERVICIO;

------


CREATE OR REPLACE FUNCTION OBTENER_COSTO_TOTAL_DOL(COD_PROD PRODUCTO.CODIGO_PRODUCTO%TYPE)
RETURN NUMBER
IS
    ANS NUMBER;
BEGIN
    SELECT P.PROMEDIO_PONDERADO INTO ANS
    FROM
    (SELECT 
        P.CODIGO_PRODUCTO,
        ROUND(SUM(PROM.COSTO_T),2) AS PROMEDIO_PONDERADO 
    FROM 
        VENDE V, 
        PRODUCTO P,
        (SELECT 
            P.CODIGO_PRODUCTO,
            P.DESCRIPCION,
            V.CANTIDAD*V.COSTODOLAR AS COSTO_T 
        FROM 
            VENDE V, 
            PRODUCTO P 
        WHERE V.CODIGO_PRODUCTO = P.CODIGO_PRODUCTO) PROM
    WHERE V.CODIGO_PRODUCTO = P.CODIGO_PRODUCTO 
        AND V.CODIGO_PRODUCTO = PROM.CODIGO_PRODUCTO
    GROUP BY P.CODIGO_PRODUCTO) P
    WHERE P.CODIGO_PRODUCTO = COD_PROD;
    RETURN ANS;
END OBTENER_COSTO_TOTAL_DOL;

CREATE OR REPLACE FUNCTION CALCULAR_MONTO(COMPRO PEDIDO.NRO_COMPROBANTE%TYPE)
RETURN NUMBER
IS
    ANS NUMBER;
    AUX NUMBER := 0;
    AUX2 NUMBER := 0;
    AUX3 NUMBER;
BEGIN
    SELECT COUNT(*) INTO AUX3 FROM CONTIENE_PRODUCTO WHERE NRO_COMPROBANTE = COMPRO;
    IF AUX3 !=0 THEN
        SELECT 
            SUM(CANTIDAD*PCR_VNT_SOL_UNIT) INTO AUX
        FROM 
            CONTIENE_PRODUCTO 
        WHERE NRO_COMPROBANTE = COMPRO;
    END IF;
    SELECT COUNT(*) INTO AUX3 FROM CONTIENE_SERVICIO WHERE NRO_COMPROBANTE = COMPRO;
    IF AUX3 !=0 THEN
        SELECT 
            SUM(C.CANTIDAD*S.PRECIO_VENTA) INTO AUX2
        FROM 
            CONTIENE_SERVICIO C,
            SERVICIO S
        WHERE S.CODIGO_SERVICIO = C.CODIGO_SERVICIO
            AND C.NRO_COMPROBANTE = COMPRO;
    END IF;
    ANS := AUX +AUX2;
    RETURN ANS;
END CALCULAR_MONTO;

CREATE OR REPLACE FUNCTION OBTENER_COD_PROD(DES PRODUCTO.DESCRIPCION%TYPE)
RETURN NUMBER
IS
    ANS NUMBER;
    AUX NUMBER;
BEGIN
    SELECT COUNT(*) INTO AUX FROM PRODUCTO WHERE DESCRIPCION = DES;
    IF AUX > 0 THEN
        SELECT CODIGO_PRODUCTO INTO ANS FROM PRODUCTO WHERE DESCRIPCION = DES;
    ELSE
        ANS:=0;
    END IF;
    RETURN ANS;
END OBTENER_COD_PROD;

CREATE OR REPLACE FUNCTION OBTENER_COD_PROV(R PERSONA_JURIDICA.RUC%TYPE)
RETURN NUMBER
IS
    AUX NUMBER;
    ANS NUMBER;
BEGIN
    SELECT COUNT(*) INTO AUX FROM PROVEEDOR WHERE RUC = R;
    IF AUX > 0 THEN
        SELECT CODIGO_PROVEEDOR INTO ANS FROM PROVEEDOR WHERE RUC = R;
    ELSE
        ANS := 0;
    END IF;
    RETURN ANS;
END OBTENER_COD_PROV;
CREATE OR REPLACE FUNCTION OBTENER_ULTIMA_BOLETA(RN NUMBER DEFAULT 0)
RETURN NUMBER
IS
    ANS NUMBER;
BEGIN
    SELECT MAX(NRO_COMPROBANTE)INTO ANS FROM PEDIDO WHERE TIPO_COMPROBANTE='BOLETA';
    RETURN ANS;   
END;

CREATE OR REPLACE FUNCTION OBTENER_ULTIMA_FACTURA(RN NUMBER DEFAULT 0)
RETURN NUMBER
IS
    ANS NUMBER;
BEGIN
    SELECT MAX(NRO_COMPROBANTE)INTO ANS FROM PEDIDO WHERE TIPO_COMPROBANTE='FACTURA';
    RETURN ANS;   
END;
--PRUEBAS

SELECT * FROM TRABAJADOR T, PERSONA_NATURAL PN WHERE T.DNI = PN.DNI;
SELECT * FROM CLIENTE C, PERSONA_NATURAL PN, PERSNAT_CLIENTE PC WHERE PC.DNI = PN.DNI AND C.COD = PC.COD;

BEGIN
    DBMS_OUTPUT.PUT_LINE(CREAR_CLIENTE_NATURAL(87654321,'FRANCO','MARQUZ','NOB','01/01/1970',999666333,'XDE'));
    DBMS_OUTPUT.PUT_LINE(CREAR_EMPLEADO(12345678,'ROBER', 'ASDA','MACHO', '10-12-1995',123456789, 'QUETEIMPORTAGIL','TUPUTAMADREGEMAIL.COM',15000,'ROBAR',''));
END;

SELECT * FROM SERVICIO;
SELECT * FROM PERSNAT_CLIENTE;
SELECT * FROM MARCA;
SELECT * FROM VENDE;
SELECT * FROM PEDIDO;
SELECT * FROM PRODUCTO;
SELECT * FROM CONTIENE_PRODUCTO;
SELECT * FROM CONTIENE_SERVICIO;
SELECT * FROM PERSONA_JURIDICA;
SELECT * FROM PERSONA_NATURAL;
SELECT * FROM PROVEEDOR;
INSERT INTO CONTIENE_PRODUCTO VALUES(6,1,9,0.28,15);
INSERT INTO PEDIDO VALUES (6,'BOLETA',355,'10/10/2100','ASDASD',12345678,100);
INSERT INTO CONTIENE_SERVICIO VALUES (6,11112222,15); 
INSERT INTO CONTIENE_PRODUCTO VALUES (5,2,2,1,2); 
DELETE FROM CONTIENE_PRODUCTO;
SET SERVEROUTPUT ON;
UPDATE PEDIDO SET ESTADO = 'ADASD' WHERE NRO_COMPROBANTE = 6;
UPDATE PRODUCTO SET PCR_VNT_SOL_UNIT  = 100 WHERE CODIGO_PRODUCTO = 1;

BEGIN
    --ACTUALIZAR_COSTO_TOTAL_ORIGEN(1);
    --ACTUALIZAR_CANTIDAD_ORIGEN(1);
    --ACT_COSTOT_CANT(1,-9,TO_NUMBER('0,28'));
    --DBMS_OUTPUT.PUT_LINE(INGRESAR_CONTIENE_PRODUCTO(6,1,9));
    --DBMS_OUTPUT.PUT_LINE(CALCULAR_MONTO(5));
    --ACTUALIZAR_EST_MON(6);
    --ELIM_TUPLAS_CONT_PROD(6);
   --ELIM_TUPLAS_CONT_SER(6);
    --DBMS_OUTPUT.PUT_LINE((CANCELAR_VENTA(6)));
   -- DBMS_OUTPUT.PUT_LINE(INGRESAR_VENDE(1,12349675691,'SDAAD','DASD',64567891,'E-002',10,1,'10/12/2021','BOB'));
   -- DBMS_OUTPUT.PUT_LINE(CREAR_PROVEEDOR(12345676891,'SDAAD','DASD',D_CJ=>45621345));
   DBMS_OUTPUT.PUT_LINE(INGRESAR_CONTIENE_SERVICIO(6,11112222,10));
END;
SELECT * FROM CONTIENE_PRODUCTO;

